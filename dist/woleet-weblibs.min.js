"use strict";!function(t,r){t.woleet=r(t.woleet)}(window,function(t){function r(t){this.name="getJSON",this.message=t.statusText&&t.statusText.length?t.statusText:"Error while getting data",this.code=t.status,this.body=t.response,this.stack=(new Error).stack}function e(t){var e=new XMLHttpRequest;return new Promise(function(n,o){e.onload=function(){switch(e.status){case 200:case 201:n("string"==typeof e.response?JSON.parse(e.response):e.response);break;case 404:n(null);break;default:o(new r(e))}},e.onerror=function(){o(new r(e))},e.open("GET",t,!0),e.responseType="json",e.json="json",e.send()})}function n(t,r,e,n,o){return"Invalid Date"==e.toString()&&(e=null),{txId:t,confirmations:r,confirmedOn:e,blockHash:n,opReturn:o}}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r;var o="https://api.woleet.io/v1",i=t||{};return i.receipt=i.receipt||{},i.anchor=i.anchor||{},i.transaction=function(){var t="woleet.io";return{setDefaultProvider:function(r){switch(r){case"blockcypher.com":t=r;break;case"woleet.io":t=r;break;case"chain.so":default:t="chain.so"}},get:function(r){switch(t){case"woleet.io":return e(o+"/bitcoin/transaction/"+r).then(function(t){if(t)return n(t.txid,t.confirmations,new Date(1e3*t.time),t.blockhash||0,function(t){var r=null;return t.forEach(function(t){if(t.hasOwnProperty("scriptPubKey")&&t.scriptPubKey.hasOwnProperty("asm")&&t.scriptPubKey.asm.indexOf("OP_RETURN")!=-1&&(r=t.scriptPubKey.asm.split(" ")[1]),r)return!0}),r}(t.vout||[]));throw new Error("tx_not_found")});case"chain.so":return e("https://chain.so/api/v2/get_tx/BTC/"+r).then(function(t){if(t&&"fail"!=t.status)return n(t.data.txid,t.data.confirmations,new Date(1e3*t.data.time),t.data.blockhash,function(t){var r=null;return t.forEach(function(t){if(t.hasOwnProperty("script")&&(t.script.indexOf("OP_RETURN")!=-1&&(r=t.script.split(" ")[1]),r))return!0}),r}(t.data.outputs||[]));throw new Error("tx_not_found")});case"blockcypher.com":return e("https://api.blockcypher.com/v1/btc/main/txs/"+r).then(function(t){if(!t||t.error)throw new Error("tx_not_found");return n(t.hash,t.confirmations,new Date(t.confirmed),t.block_hash,function(t){var r=null;return t.forEach(function(t){if(t.hasOwnProperty("data_hex")&&(r=t.data_hex),r)return!0}),r}(t.outputs||[]))})}}}}(),i.anchor.getAnchorIDs=function(t,r){return r=r||20,e(o+"/anchorids?size="+r+"&hash="+t)},i.receipt.get=function(t){return e(o+"/receipt/"+t).then(function(t){if(t)return t;throw new Error("not_found")})},i.isSHA256=function(t){var r=/^[A-Fa-f0-9]{64}$/;return r.test(t)},i}),function(t,r){t.woleet=r(t.woleet)}(window,function(t){function r(t,r,e){var o=e||n,i=t,a=r,s=o(i+a);this.get_parent=function(){return s},this.contains=function(t){return i==t||a==t},this.get_json=function(){return{parent:s,left:i,right:a}}}function e(t,r){var e=this;this.hash_f=r||n,this.branches=[],this.target=t,this.add=function(t){e.branches.push(t)},this.is_valid=function(){var t=e.target;if(!e.branches.length)return!1;for(var r,n=0;n<e.branches.length;n++){if(r=e.branches[n],!r.contains(t))return!1;t=r.get_parent()}return t},this.get_json=function(){var t=[];return e.branches.forEach(function(r){t.push(r.get_json())}),t}}var n=function(){function t(t,r){return r>>>t|r<<32-t}function r(r){return t(2,r)^t(13,r)^t(22,r)}function e(r){return t(6,r)^t(11,r)^t(25,r)}function n(r){return t(7,r)^t(18,r)^r>>>3}function o(r){return t(17,r)^t(19,r)^r>>>10}function i(t,r,e){return t&r^~t&e}function a(t,r,e){return t&r^t&e^r&e}return function(t){var s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];t+=String.fromCharCode(128);for(var f=t.length/4+2,u=Math.ceil(f/16),h=new Array(u),l=0;l<u;l++){h[l]=new Array(16);for(var d=0;d<16;d++)h[l][d]=t.charCodeAt(64*l+4*d)<<24|t.charCodeAt(64*l+4*d+1)<<16|t.charCodeAt(64*l+4*d+2)<<8|t.charCodeAt(64*l+4*d+3)}var w=8*(t.length-1)/Math.pow(2,32),p=8*(t.length-1)>>>0;h[u-1][14]=Math.floor(w),h[u-1][15]=p;for(var _=0;_<u;_++){for(var g=new Array(64),v=0;v<16;v++)g[v]=h[_][v];for(var m=16;m<64;m++)g[m]=o(g[m-2])+g[m-7]+n(g[m-15])+g[m-16]>>>0;for(var y=c[0],b=c[1],E=c[2],k=c[3],A=c[4],x=c[5],S=c[6],O=c[7],P=0;P<64;P++){var R=O+e(A)+i(A,x,S)+s[P]+g[P],C=r(y)+a(y,b,E);O=S,S=x,x=A,A=k+R>>>0,k=E,E=b,b=y,y=R+C>>>0}c[0]=c[0]+y>>>0,c[1]=c[1]+b>>>0,c[2]=c[2]+E>>>0,c[3]=c[3]+k>>>0,c[4]=c[4]+A>>>0,c[5]=c[5]+x>>>0,c[6]=c[6]+S>>>0,c[7]=c[7]+O>>>0}for(var H=0;H<c.length;H++)c[H]=("00000000"+c[H].toString(16)).slice(-8);return c.join("")}}(),o=t||{};return o.receipt=o.receipt||{},o.receipt.validate=function(t){if(!(t&&t.target&&t.target.target_hash&&t.target.target_proof&&t.target.target_proof instanceof Array&&t.header&&t.header.hash_type&&t.header.merkle_root&&t.header.tx_id))throw new Error("invalid_receipt_format");for(var n=0;n<t.target.target_proof.length;n++){var i=t.target.target_proof[n];if(!i.left||!i.right||!i.parent)throw new Error("invalid_target_proof");if(!o.isSHA256(i.left)||!o.isSHA256(i.right)||!o.isSHA256(i.parent))throw new Error("non_sha256_target_proof_element")}if(0==t.target.target_proof.length){if(t.target.target_hash==t.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")}var a=new e(t.target.target_hash);if(t.target.target_proof.forEach(function(t){var e=new r(t.left,t.right);if(!e.get_parent()==t.parent)throw new Error("invalid_parent_in_proof_element");a.add(e)}),a.is_valid()==t.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")},o}),function(t,r){t.woleet=r(t.woleet)}(window,function(t){var r=t||{};r.receipt=r.receipt||{},r.anchor=r.anchor||{},r.verify=r.verify||{},r.verify.WoleetDAB=function(t,n){return e(t,n).then(function(t){return r.anchor.getAnchorIDs(t)}).then(function(t){var e=[];return t.content.reduce(function(t,n){return t.then(function(){return r.receipt.get(n).then(function(t){return e.push(t)},function(t){if(202!=t.code)throw t})})},Promise.resolve()).then(function(){if(!e.length&&t.content.length)throw new Error("file_matched_but_anchor_not_yet_processed");return e})}).then(function(t){var e=t.map(function(t){try{return r.receipt.validate(t)}catch(t){return!1}}),n=e.every(function(t){return 1==t}),o=[];if(n)return t.reduce(function(t,e){return t.then(function(){return r.transaction.get(e.header.tx_id).then(function(t){o.push({receipt:e,confirmations:t.confirmations,date:t.confirmedOn})})})},Promise.resolve()).then(function(){return o});throw new Error("invalid_receipt")})},r.verify.DAB=function(t,n,o){return e(t,o).then(function(t){if(r.receipt.validate(n),n.target.target_hash!=t)throw new Error("target_hash_mismatch");return r.transaction.get(n.header.tx_id).then(function(t){return t},function(t){throw"tx_not_found"==t.message?t:new Error("error_while_getting_transaction")})}).then(function(t){if(t.opReturn==n.header.merkle_root)return{receipt:n,confirmations:t.confirmations,confirmedOn:t.confirmedOn};throw new Error("opReturn_mismatches_merkleRoot")})};var e=function(t,e){var n,o,i=new Promise(function(t,r){n=t,o=r});if(t instanceof File){if(!r.file||!r.file.Hasher)throw new Error("missing_woleet_hash_dependency");var a=new r.file.Hasher;a.on("result",function(t,r){n(t.result),e&&e({progress:1,file:File})}),e&&"function"==typeof e&&a.on("progress",e),a.on("error",function(t){o(t)}),a.start(t)}else"string"==typeof t?r.isSHA256(t)?n(t):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"));return i};return r}),function(t,r){t.woleet=r(t.woleet)}(window,function(t){function r(){var t=document.getElementsByTagName("script"),r=t[t.length-1].src,e=r.substr(0,r.lastIndexOf("/")+1);return e}function e(){function t(t){var r=window.URL||window.webkitURL,e=window.Blob,n=window.Worker;if(!(r&&e&&n&&t))return null;var o=new e([t]);return new n(r.createObjectURL(o))}return new Promise(function(r){var e="onmessage = function(e) { postMessage(!!FileReaderSync); };";try{var n=t(e);n?(n.onmessage=function(t){r(t.data)},n.postMessage({})):r(!1)}catch(t){r(!1)}})}var n=r(),o="worker.min.js",i=t.workerScriptPath||(n?n+o:null);if(!i)throw new Error("Cannot find "+o);var a=e(),s=t||{};return s.file=s.file||{},s.file.Hasher=function(){var t,r,e,n,o=!0;this.on=function(o,i){switch(o){case"start":t=i;break;case"progress":r=i;break;case"error":n=i;break;case"result":e=i;break;default:throw new Error('Invalid event name "'+o+'"')}};var s=function(a,s){function c(){f>=s?(u.terminate(),o=!0):(u.postMessage(a.item(f)),f++)}var f=0,u=new Worker(i);u.onmessage=function(o){if(void 0!=o.data.progress)r&&r(o.data);else if(o.data.result)e&&e(o.data),c();else if(o.data.start)t&&t(o.data);else if(o.data.error){var i=o.data.error;if(!n)throw i;n(i)}else console.trace("Unexpected worker message: ",o)},s!=-1?c():u.postMessage(a)},c=function(i,a){function s(i){var a=new Error("file_too_big_to_be_hashed_without_worker");if(i.size>5e7){if(o=!0,n)return n({error:a,file:i});throw a}t&&t({start:!0,file:i});var s,f=new FileReader,u=CryptoJS.algo.SHA256.create(),h=0;f.onloadend=function(){s.finalize(),e&&e({result:s._hash.toString(CryptoJS.enc.Hex),file:i}),c()},f.onprogress=function(t){var e=t.target.result,n=e.slice(h,t.loaded),o=new Uint8Array(n),a=CryptoJS.lib.WordArray.create(o);s=u.update(a),h=t.loaded,r&&r({progress:t.loaded/t.total,file:i})},f.readAsArrayBuffer(i)}function c(){f>=a?o=!0:(s(i.item(f)),f++)}var f=0;a!=-1?c():s(i)};this.start=function(t){if(!o)throw new Error("not_ready");var r=-1;if(t instanceof FileList)r=t.length;else if(!(t instanceof File))throw new Error("invalid_parameter");o=!1,a.then(function(e){if(e)s(t,r);else{if("undefined"==typeof CryptoJS)throw new Error("no_viable_hash_method");c(t,r)}})},this.isReady=function(){return o}},s});
//# sourceMappingURL=woleet-weblibs.min.js.map
