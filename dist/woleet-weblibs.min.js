"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){e.woleet=t(e.woleet)}(window,function(e){function t(e){this.name="getJSON",this.message=e.statusText&&e.statusText.length?e.statusText:"Error while getting data",this.code=e.status,this.body=e.response,this.stack=(new Error).stack}function r(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new XMLHttpRequest;return new Promise(function(o,i){n.onload=function(){switch(n.status){case 200:case 201:o("string"==typeof n.response?JSON.parse(n.response):n.response);break;case 404:o(null);break;default:i(new t(n))}},n.onerror=function(){i(new t(n))},n.open(r.method||"GET",e,!0),r.token&&n.setRequestHeader("Authorization","Bearer "+r.token),"POST"==r.method&&n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json"),n.responseType="json",n.json="json",n.send("object"==_typeof(r.data)?JSON.stringify(r.data):r.data)})}function n(e,t,r,n,o){return"Invalid Date"==r.toString()&&(r=null),{txId:e,confirmations:t,confirmedOn:r,blockHash:n,opReturn:o}}t.prototype=Object.create(Error.prototype),t.prototype.constructor=t;var o="https://api.woleet.io/v1",i=e||{};return i.receipt=i.receipt||{},i.anchor=i.anchor||{},i.transaction=function(){var e="woleet.io";return{setDefaultProvider:function(t){switch(t){case"blockcypher.com":e=t;break;case"woleet.io":e=t;break;case"chain.so":default:e="chain.so"}},get:function(t){switch(e){case"woleet.io":return r(o+"/bitcoin/transaction/"+t).then(function(e){if(e)return n(e.txid,e.confirmations,new Date(1e3*e.time),e.blockhash||0,function(e){var t=null;return e.forEach(function(e){if(e.hasOwnProperty("scriptPubKey")&&e.scriptPubKey.hasOwnProperty("asm")&&e.scriptPubKey.asm.indexOf("OP_RETURN")!=-1&&(t=e.scriptPubKey.asm.split(" ")[1]),t)return!0}),t}(e.vout||[]));throw new Error("tx_not_found")});case"chain.so":return r("https://chain.so/api/v2/get_tx/BTC/"+t).then(function(e){if(e&&"fail"!=e.status)return n(e.data.txid,e.data.confirmations,new Date(1e3*e.data.time),e.data.blockhash,function(e){var t=null;return e.forEach(function(e){if(e.hasOwnProperty("script")&&(e.script.indexOf("OP_RETURN")!=-1&&(t=e.script.split(" ")[1]),t))return!0}),t}(e.data.outputs||[]));throw new Error("tx_not_found")});case"blockcypher.com":return r("https://api.blockcypher.com/v1/btc/main/txs/"+t).then(function(e){if(!e||e.error)throw new Error("tx_not_found");return n(e.hash,e.confirmations,new Date(e.confirmed),e.block_hash,function(e){var t=null;return e.forEach(function(e){if(e.hasOwnProperty("data_hex")&&(t=e.data_hex),t)return!0}),t}(e.outputs||[]))})}}}}(),i.anchor.getAnchorIDs=function(e,t){return t=t||20,r(o+"/anchorids?size="+t+"&hash="+e)},i.receipt.get=function(e){return r(o+"/receipt/"+e).then(function(e){if(e)return e;throw new Error("not_found")})},i.isSHA256=function(e){var t=/^[A-Fa-f0-9]{64}$/;return t.test(e)},i._getJSON=r,i._woleetAPI=o,i}),function(e,t){e.woleet=t(e.woleet)}(window,function(e){function t(e,t,r){var o=r||n,i=e,a=t,s=o(i+a);this.get_parent=function(){return s},this.contains=function(e){return i==e||a==e},this.get_json=function(){return{parent:s,left:i,right:a}}}function r(e,t){var r=this;this.hash_f=t||n,this.branches=[],this.target=e,this.add=function(e){r.branches.push(e)},this.is_valid=function(){var e=r.target;if(!r.branches.length)return!1;for(var t,n=0;n<r.branches.length;n++){if(t=r.branches[n],!t.contains(e))return!1;e=t.get_parent()}return e},this.get_json=function(){var e=[];return r.branches.forEach(function(t){e.push(t.get_json())}),e}}var n=function(){function e(e,t){return t>>>e|t<<32-e}function t(t){return e(2,t)^e(13,t)^e(22,t)}function r(t){return e(6,t)^e(11,t)^e(25,t)}function n(t){return e(7,t)^e(18,t)^t>>>3}function o(t){return e(17,t)^e(19,t)^t>>>10}function i(e,t,r){return e&t^~e&r}function a(e,t,r){return e&t^e&r^t&r}return function(e){var s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];e+=String.fromCharCode(128);for(var f=e.length/4+2,u=Math.ceil(f/16),h=new Array(u),l=0;l<u;l++){h[l]=new Array(16);for(var d=0;d<16;d++)h[l][d]=e.charCodeAt(64*l+4*d)<<24|e.charCodeAt(64*l+4*d+1)<<16|e.charCodeAt(64*l+4*d+2)<<8|e.charCodeAt(64*l+4*d+3)}var p=8*(e.length-1)/Math.pow(2,32),w=8*(e.length-1)>>>0;h[u-1][14]=Math.floor(p),h[u-1][15]=w;for(var _=0;_<u;_++){for(var g=new Array(64),v=0;v<16;v++)g[v]=h[_][v];for(var m=16;m<64;m++)g[m]=o(g[m-2])+g[m-7]+n(g[m-15])+g[m-16]>>>0;for(var y=c[0],b=c[1],E=c[2],S=c[3],k=c[4],A=c[5],P=c[6],O=c[7],x=0;x<64;x++){var H=O+r(k)+i(k,A,P)+s[x]+g[x],R=t(y)+a(y,b,E);O=P,P=A,A=k,k=S+H>>>0,S=E,E=b,b=y,y=H+R>>>0}c[0]=c[0]+y>>>0,c[1]=c[1]+b>>>0,c[2]=c[2]+E>>>0,c[3]=c[3]+S>>>0,c[4]=c[4]+k>>>0,c[5]=c[5]+A>>>0,c[6]=c[6]+P>>>0,c[7]=c[7]+O>>>0}for(var F=0;F<c.length;F++)c[F]=("00000000"+c[F].toString(16)).slice(-8);return c.join("")}}(),o=e||{};return o.receipt=o.receipt||{},o.receipt.validate=function(e){if(!(e&&e.target&&e.target.target_hash&&e.target.target_proof&&e.target.target_proof instanceof Array&&e.header&&e.header.hash_type&&e.header.merkle_root&&e.header.tx_id))throw new Error("invalid_receipt_format");for(var n=0;n<e.target.target_proof.length;n++){var i=e.target.target_proof[n];if(!i.left||!i.right||!i.parent)throw new Error("invalid_target_proof");if(!o.isSHA256(i.left)||!o.isSHA256(i.right)||!o.isSHA256(i.parent))throw new Error("non_sha256_target_proof_element")}if(0==e.target.target_proof.length){if(e.target.target_hash==e.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")}var a=new r(e.target.target_hash);if(e.target.target_proof.forEach(function(e){var r=new t(e.left,e.right);if(!r.get_parent()==e.parent)throw new Error("invalid_parent_in_proof_element");a.add(r)}),a.is_valid()==e.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")},o}),function(e,t){e.woleet=t(e.woleet)}(window,function(e){var t=e||{};t.receipt=t.receipt||{},t.anchor=t.anchor||{},t.verify=t.verify||{},t.verify.WoleetDAB=function(e,n){return r(e,n).then(function(e){return t.anchor.getAnchorIDs(e)}).then(function(e){var r=[];return e.content.reduce(function(e,n){return e.then(function(){return t.receipt.get(n).then(function(e){return r.push(e)},function(e){if(202!=e.code)throw e})})},Promise.resolve()).then(function(){if(!r.length&&e.content.length)throw new Error("file_matched_but_anchor_not_yet_processed");return r})}).then(function(e){var r=e.map(function(e){try{return t.receipt.validate(e)}catch(e){return!1}}),n=r.every(function(e){return 1==e}),o=[];if(n)return e.reduce(function(e,r){return e.then(function(){return t.transaction.get(r.header.tx_id).then(function(e){o.push({receipt:r,confirmations:e.confirmations,date:e.confirmedOn})})})},Promise.resolve()).then(function(){return o});throw new Error("invalid_receipt")})},t.verify.DAB=function(e,n,o){return r(e,o).then(function(e){if(t.receipt.validate(n),n.target.target_hash!=e)throw new Error("target_hash_mismatch");return t.transaction.get(n.header.tx_id).then(function(e){return e},function(e){throw"tx_not_found"==e.message?e:new Error("error_while_getting_transaction")})}).then(function(e){if(e.opReturn==n.header.merkle_root)return{receipt:n,confirmations:e.confirmations,confirmedOn:e.confirmedOn};throw new Error("opReturn_mismatches_merkleRoot")})};var r=function(e,r){var n,o,i=new Promise(function(e,t){n=e,o=t});if(e instanceof File){if(!t.file||!t.file.Hasher)throw new Error("missing_woleet_hash_dependency");var a=new t.file.Hasher;a.on("result",function(e,t){n(e.result),r&&r({progress:1,file:File})}),r&&"function"==typeof r&&a.on("progress",r),a.on("error",function(e){o(e)}),a.start(e)}else"string"==typeof e?t.isSHA256(e)?n(e):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"));return i};return t}),function(e,t){e.woleet=t(e.woleet)}(window,function(e){var t=e||{};t.receipt=t.receipt||{},t.anchor=t.anchor||{},t.verify=t.verify||{};var r=t._hashStringOrFile,n=t._getJSON,o=t._woleetAPI,i=null;return t.token={set:function(e){i=e},get:function(e,t){}},t.anchor.create=function(e,t){return r(e,t).then(function(t){var r={public:!0,name:e.name,hash:t};return n(o+"/anchor",{data:r,method:"POST",token:i})}).then(console.info)},t});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){e.woleet=t(e.woleet)}(window,function(e){function t(){var e=document.getElementsByTagName("script"),t=Array.prototype.slice.call(e,0),r=/.*woleet-(hashfile|weblibs)[.min]*\.js$/,n=t.find(function(e){return e.src&&e.src.match(r)});return n&&n.src?n.src.substr(0,n.src.lastIndexOf("/")+1):null}function r(){function e(e){var t=window.URL||window.webkitURL,r=window.Blob,n=window.Worker;if(!(t&&r&&n&&e))return null;var o=new r([e]);return new n(t.createObjectURL(o))}return new Promise(function(t){var r="onmessage = function(e) { postMessage(!!FileReaderSync); };";try{var n=e(r);n?(n.onmessage=function(e){t(e.data)},n.postMessage({})):t(!1)}catch(e){t(!1)}})}var n=r(),o=window.crypto&&window.crypto.subtle&&window.crypto.subtle.digest,i=e||{};i.file=i.file||{};var a=t();console.log(a);var s="woleet-hashfile-worker.min.js",c=i.workerScriptPath||(a?a+s:null);if(!c)throw new Error("Cannot find "+s);return i.file.Hasher=function(){var e=!0,t=void 0,r=void 0,i=void 0,a=void 0;this.on=function(e,n){switch(e){case"start":t=n;break;case"progress":r=n;break;case"error":a=n;break;case"result":i=n;break;default:throw new Error('Invalid event name "'+e+'"')}};var s=function(e){return new Promise(function(n,o){var s=new Worker(c);s.onmessage=function(e){if(void 0!=e.data.progress)r&&r(e.data);else if(e.data.result)i&&i(e.data),n();else if(e.data.start)t&&t(e.data);else if(e.data.error){var s=e.data.error;a?a(s):o(s)}else console.trace("Unexpected worker message: ",e)},s.postMessage(e)})},f=function(n){return new Promise(function(o,s){var c=new Error("file_too_big_to_be_hashed_without_worker");if(n.size>5e7){if(e=!0,a)return a({error:c,file:n});s(error)}var f=new FileReader,u=CryptoJS.algo.SHA256.create(),h=void 0,l=0;f.onloadstart=function(){t&&t({start:!0,file:n})},f.onloadend=function(){h.finalize(),i&&i({result:h._hash.toString(CryptoJS.enc.Hex),file:n}),o()},f.onprogress=function(e){var t=e.target.result,o=t.slice(l,e.loaded),i=new Uint8Array(o),a=CryptoJS.lib.WordArray.create(i);h=u.update(a),l=e.loaded,r&&r({progress:e.loaded/e.total,file:n})},f.readAsArrayBuffer(n)})},u=function(e){return new Promise(function(n,o){var s="SHA-256",c=new FileReader;c.onloadstart=function(){t&&t({start:!0,file:e})},c.onprogress=function(t){r&&r({progress:t.loaded/t.total,file:e})},c.onload=function(t){var r=t.target.result;window.crypto.subtle.digest(s,r).then(function(t){var r=new Uint8Array(t),o=r.reduce(function(e,t){return e+("00"+t.toString(16)).slice(-2)},"");i&&i({result:o,file:e}),n()}).catch(function(t){return a?a({error:t,file:e}):o(t)})},c.readAsArrayBuffer(e)})};this.start=function(t){if(!e)throw new Error("not_ready");if(e=!1,!(t instanceof FileList||t instanceof File))throw new Error("invalid_parameter");n.then(function(r){function n(r,o){r>=o?e=!0:i(t[r]).then(function(){n(++r,o)})}var i=null;if(o)i=u;else if(r)i=s;else{if("undefined"==typeof CryptoJS)throw new Error("no_viable_hash_method");i=f}console.log("files is",t instanceof FileList,t instanceof File,"undefined"==typeof t?"undefined":_typeof(t)),t instanceof FileList?(console.log("iter file"),n(0,t.length)):t instanceof File&&(console.log("iter files"),i(t).then(function(){e=!0}))})},this.isReady=function(){return e}},i._hashStringOrFile=function(e,t){var r=void 0,n=void 0,o=new Promise(function(e,t){r=e,n=t});if(e instanceof File){if(!i.file||!i.file.Hasher)throw new Error("missing_woleet_hash_dependency");var a=new i.file.Hasher;a.on("result",function(e,n){r(e.result),t&&t({progress:1,file:File})}),t&&"function"==typeof t&&a.on("progress",t),a.on("error",function(e){n(e)}),a.start(e)}else"string"==typeof e?i.isSHA256(e)?r(e):n(new Error("parameter_string_not_a_sha256_hash")):n(new Error("invalid_parameter"));return o},i});
//# sourceMappingURL=woleet-weblibs.min.js.map
