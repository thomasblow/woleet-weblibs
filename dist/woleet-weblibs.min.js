"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){t.woleet=e(t.woleet)}(window,function(t){function e(t){this.name="getJSON",this.message=t.statusText&&t.statusText.length?t.statusText:"Error while getting data",this.code=t.status,this.body=t.response,this.stack=(new Error).stack}function r(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new XMLHttpRequest;return new Promise(function(o,i){n.onload=function(){switch(n.status){case 200:case 201:o("string"==typeof n.response?JSON.parse(n.response):n.response);break;case 404:o(null);break;default:i(new e(n))}},n.onerror=function(){i(new e(n))},n.open(r.method||"GET",t,!0),r.token&&n.setRequestHeader("Authorization","Bearer "+r.token),"POST"==r.method&&n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json"),n.responseType="json",n.json="json",n.send("object"==_typeof(r.data)?JSON.stringify(r.data):r.data)})}function n(t,e,r,n,o){return"Invalid Date"==r.toString()&&(r=null),{txId:t,confirmations:e,confirmedOn:r,blockHash:n,opReturn:o}}e.prototype=Object.create(Error.prototype),e.prototype.constructor=e;var o="https://api.woleet.io/v1",i=t||{};return i.receipt=i.receipt||{},i.anchor=i.anchor||{},i.transaction=function(){var t="woleet.io";return{setDefaultProvider:function(e){switch(e){case"blockcypher.com":t=e;break;case"woleet.io":t=e;break;case"chain.so":default:t="chain.so"}},get:function(e){switch(t){case"woleet.io":return r(o+"/bitcoin/transaction/"+e).then(function(t){if(t)return n(t.txid,t.confirmations,new Date(1e3*t.time),t.blockhash||0,function(t){var e=null;return t.forEach(function(t){if(t.hasOwnProperty("scriptPubKey")&&t.scriptPubKey.hasOwnProperty("asm")&&t.scriptPubKey.asm.indexOf("OP_RETURN")!=-1&&(e=t.scriptPubKey.asm.split(" ")[1]),e)return!0}),e}(t.vout||[]));throw new Error("tx_not_found")});case"chain.so":return r("https://chain.so/api/v2/get_tx/BTC/"+e).then(function(t){if(t&&"fail"!=t.status)return n(t.data.txid,t.data.confirmations,new Date(1e3*t.data.time),t.data.blockhash,function(t){var e=null;return t.forEach(function(t){if(t.hasOwnProperty("script")&&(t.script.indexOf("OP_RETURN")!=-1&&(e=t.script.split(" ")[1]),e))return!0}),e}(t.data.outputs||[]));throw new Error("tx_not_found")});case"blockcypher.com":return r("https://api.blockcypher.com/v1/btc/main/txs/"+e).then(function(t){if(!t||t.error)throw new Error("tx_not_found");return n(t.hash,t.confirmations,new Date(t.confirmed),t.block_hash,function(t){var e=null;return t.forEach(function(t){if(t.hasOwnProperty("data_hex")&&(e=t.data_hex),e)return!0}),e}(t.outputs||[]))})}}}}(),i.anchor.getAnchorIDs=function(t,e){return e=e||20,r(o+"/anchorids?size="+e+"&hash="+t)},i.receipt.get=function(t){return r(o+"/receipt/"+t).then(function(t){if(t)return t;throw new Error("not_found")})},i.isSHA256=function(t){var e=/^[A-Fa-f0-9]{64}$/;return e.test(t)},i._getJSON=r,i._woleetAPI=o,i}),function(t,e){t.woleet=e(t.woleet)}(window,function(t){function e(t,e,r){var o=r||n,i=t,a=e,c=o(i+a);this.get_parent=function(){return c},this.contains=function(t){return i==t||a==t},this.get_json=function(){return{parent:c,left:i,right:a}}}function r(t,e){var r=this;this.hash_f=e||n,this.branches=[],this.target=t,this.add=function(t){r.branches.push(t)},this.is_valid=function(){var t=r.target;if(!r.branches.length)return!1;for(var e,n=0;n<r.branches.length;n++){if(e=r.branches[n],!e.contains(t))return!1;t=e.get_parent()}return t},this.get_json=function(){var t=[];return r.branches.forEach(function(e){t.push(e.get_json())}),t}}var n=function(){function t(t,e){return e>>>t|e<<32-t}function e(e){return t(2,e)^t(13,e)^t(22,e)}function r(e){return t(6,e)^t(11,e)^t(25,e)}function n(e){return t(7,e)^t(18,e)^e>>>3}function o(e){return t(17,e)^t(19,e)^e>>>10}function i(t,e,r){return t&e^~t&r}function a(t,e,r){return t&e^t&r^e&r}return function(t){var c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];t+=String.fromCharCode(128);for(var u=t.length/4+2,f=Math.ceil(u/16),h=new Array(f),l=0;l<f;l++){h[l]=new Array(16);for(var d=0;d<16;d++)h[l][d]=t.charCodeAt(64*l+4*d)<<24|t.charCodeAt(64*l+4*d+1)<<16|t.charCodeAt(64*l+4*d+2)<<8|t.charCodeAt(64*l+4*d+3)}var p=8*(t.length-1)/Math.pow(2,32),w=8*(t.length-1)>>>0;h[f-1][14]=Math.floor(p),h[f-1][15]=w;for(var _=0;_<f;_++){for(var g=new Array(64),m=0;m<16;m++)g[m]=h[_][m];for(var v=16;v<64;v++)g[v]=o(g[v-2])+g[v-7]+n(g[v-15])+g[v-16]>>>0;for(var y=s[0],b=s[1],k=s[2],E=s[3],S=s[4],A=s[5],x=s[6],O=s[7],P=0;P<64;P++){var R=O+r(S)+i(S,A,x)+c[P]+g[P],H=e(y)+a(y,b,k);O=x,x=A,A=S,S=E+R>>>0,E=k,k=b,b=y,y=R+H>>>0}s[0]=s[0]+y>>>0,s[1]=s[1]+b>>>0,s[2]=s[2]+k>>>0,s[3]=s[3]+E>>>0,s[4]=s[4]+S>>>0,s[5]=s[5]+A>>>0,s[6]=s[6]+x>>>0,s[7]=s[7]+O>>>0}for(var C=0;C<s.length;C++)s[C]=("00000000"+s[C].toString(16)).slice(-8);return s.join("")}}(),o=t||{};return o.receipt=o.receipt||{},o.receipt.validate=function(t){if(!(t&&t.target&&t.target.target_hash&&t.target.target_proof&&t.target.target_proof instanceof Array&&t.header&&t.header.hash_type&&t.header.merkle_root&&t.header.tx_id))throw new Error("invalid_receipt_format");for(var n=0;n<t.target.target_proof.length;n++){var i=t.target.target_proof[n];if(!i.left||!i.right||!i.parent)throw new Error("invalid_target_proof");if(!o.isSHA256(i.left)||!o.isSHA256(i.right)||!o.isSHA256(i.parent))throw new Error("non_sha256_target_proof_element")}if(0==t.target.target_proof.length){if(t.target.target_hash==t.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")}var a=new r(t.target.target_hash);if(t.target.target_proof.forEach(function(t){var r=new e(t.left,t.right);if(!r.get_parent()==t.parent)throw new Error("invalid_parent_in_proof_element");a.add(r)}),a.is_valid()==t.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")},o});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){t.woleet=e(t.woleet)}(window,function(t){var e=t||{};return e.receipt=e.receipt||{},e.anchor=e.anchor||{},e.verify=e.verify||{},e.verify.WoleetDAB=function(t,r){return e.hashFileOrCheckHash(t,r).then(function(t){return e.anchor.getAnchorIDs(t)}).then(function(t){var r=[];return t.content.reduce(function(t,n){return t.then(function(){return e.receipt.get(n).then(function(t){return r.push(t)}).catch(function(t){if(202!=t.code)throw t})})},Promise.resolve()).then(function(){if(!r.length&&t.content.length)throw new Error("file_matched_but_anchor_not_yet_processed");return r})}).then(function(t){var r=t.map(function(t){try{return e.receipt.validate(t),!0}catch(t){return!1}}),n=r.every(function(t){return 1==t});if(!n)throw new Error("invalid_receipt");var o=function(){var r=[];return{v:t.reduce(function(t,n){return t.then(function(){return e.transaction.get(n.header.tx_id).then(function(t){if(t.opReturn!=n.header.merkle_root)throw new Error("opReturn_mismatches_merkleRoot");r.push({receipt:n,confirmations:t.confirmations,confirmedOn:t.confirmedOn})})})},Promise.resolve()).then(function(){return r})}}();if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v})},e.verify.DAB=function(t,r,n){return e.hashFileOrCheckHash(t,n).then(function(t){if(e.receipt.validate(r),r.target.target_hash!=t)throw new Error("target_hash_mismatch");return e.transaction.get(r.header.tx_id).catch(function(t){if("tx_not_found"==t.message)throw t;return e.transaction.setDefaultProvider("blockcypher.com"),e.transaction.get(r.header.tx_id)}).catch(function(t){throw"tx_not_found"==t.message?t:new Error("error_while_getting_transaction")})}).then(function(t){if(t.opReturn==r.header.merkle_root)return{receipt:r,confirmations:t.confirmations,confirmedOn:t.confirmedOn};throw new Error("opReturn_mismatches_merkleRoot")})},e}),function(t,e){t.woleet=e(t.woleet)}(window,function(t){function e(){var t=document.getElementsByTagName("script"),e=Array.prototype.slice.call(t,0),r=/.*woleet-(hashfile|weblibs)[.min]*\.js$/,n=e.find(function(t){return t.src&&t.src.match(r)});return n&&n.src?n.src.substr(0,n.src.lastIndexOf("/")+1):null}function r(){function t(t){var e=window.URL||window.webkitURL,r=window.Blob,n=window.Worker;if(!(e&&r&&n&&t))return null;var o=new r([t]);return new n(e.createObjectURL(o))}return new Promise(function(e){var r="onmessage = function(e) { postMessage(!!FileReaderSync); close() };";try{!function(){var n=t(r);n?(n.onmessage=function(t){n.terminate(),n=null,e(t.data)},n.postMessage({})):e(!1)}()}catch(t){e(!1)}})}var n=t||{};n.file=n.file||{};var o="https:"==location.protocol,i=window.crypto&&window.crypto.subtle&&window.crypto.subtle.digest&&o,a=r(),c=e(),s="woleet-hashfile-worker.min.js",u=n.workerScriptPath||(c?c+s:null);if(!u)throw new Error("Cannot find "+s);return n.file.Hasher=function(){var t=!0,e=void 0,r=void 0,n=void 0,o=void 0,c=null,s=function(t){return c=t};this.on=function(t,i){switch(t){case"start":e=i;break;case"progress":r=i;break;case"error":o=i;break;case"result":n=i;break;default:throw new Error('Invalid event name "'+t+'"')}};var f=function(){var t=new Worker(u);this.hash=function(i){return new Promise(function(a,c){s(function(){t.terminate(),t=null,c("cancelled")}),t.onmessage=function(i){if(void 0!=i.data.progress)r&&r(i.data);else if(i.data.result)n&&n(i.data),a(t);else if(i.data.start)e&&e(i.data);else if(i.data.error){var s=i.data.error;o?o(s):c(s)}else console.trace("Unexpected worker message: ",i)},t.postMessage(i)})}},h=function(i){return new Promise(function(a,c){var u=new Error("file_too_big_to_be_hashed_without_worker");if(i.size>5e7){if(t=!0,o)return o({error:u,file:i});c(u)}var f=!1,h=new FileReader;s(function(){f=!0,h.abort()});var l=CryptoJS.algo.SHA256.create(),d=void 0,p=0;h.onloadstart=function(){f||e&&e({start:!0,file:i})},h.onloadend=function(){f||(d.finalize(),n&&n({result:d._hash.toString(CryptoJS.enc.Hex),file:i}),a())},h.onprogress=function(t){if(!f){var e=t.target.result,n=e.slice(p,t.loaded),o=new Uint8Array(n),a=CryptoJS.lib.WordArray.create(o);d=l.update(a),p=t.loaded,r&&r({progress:t.loaded/t.total,file:i})}},h.onabort=function(){c("cancelled")},h.readAsArrayBuffer(i)})},l=function(t){return new Promise(function(i,a){var c="SHA-256",u=!1,f=new FileReader;s(function(){u=!0,f.abort()}),f.onloadstart=function(){u||e&&e({start:!0,file:t})},f.onprogress=function(e){u||r&&r({progress:e.loaded/e.total,file:t})},f.onload=function(e){if(!u){var r=e.target.result;window.crypto.subtle.digest(c,r).then(function(e){var r=new Uint8Array(e),o=r.reduce(function(t,e){return t+("00"+e.toString(16)).slice(-2)},"");n&&n({result:o,file:t}),i()}).catch(function(e){return o?o({error:e,file:t}):a(e)})}},f.onabort=function(){a("cancelled")},f.readAsArrayBuffer(t)})};this.start=function(e){var r=5e8,n=null;if(!t)throw new Error("not_ready");if(t=!1,!(e instanceof FileList||e instanceof File))throw new Error("invalid_parameter");a.then(function(o){function a(e,c,s,u){if(!(e>=c)){var d=null;if(i&&s[e].size<r)d=l;else if(o)n||(n=new f),d=n.hash;else{if("undefined"==typeof CryptoJS)throw t=!0,new Error("no_viable_hash_method");d=h}return d(s[e]).then(function(t){return a(e+1,c,s,t||u)}).catch(function(t){if("cancelled"!==t)throw t})}t=!0,u&&(u.terminate(),u=null)}return e instanceof FileList?a(0,e.length,e):e instanceof File?a(0,1,[e]):void 0})},this.cancel=function(){c&&(c(),c=null,t=!0)},this.isReady=function(){return t}},n.hashFileOrCheckHash=function(t,e){return new Promise(function(r,o){if(t instanceof File){if(!n.file||!n.file.Hasher)throw new Error("missing_woleet_hash_dependency");var i=new n.file.Hasher;i.on("result",function(t,n){r(t.result),e&&e({progress:1,file:n})}),e&&"function"==typeof e&&i.on("progress",e),i.on("error",o),i.start(t)}else"string"==typeof t?n.isSHA256(t)?r(t):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"))})},n});
//# sourceMappingURL=woleet-weblibs.min.js.map
