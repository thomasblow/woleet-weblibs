"use strict";!function(e,r){e.woleet=r(e.woleet)}(window,function(e){function r(e,r){var t=void 0,o=void 0,i=new Promise(function(e,r){t=e,o=r});if(e instanceof File){if(!n.file||!n.file.Hasher)throw new Error("missing_woleet_hash_dependency");var c=new n.file.Hasher;c.on("result",function(e,n){t(e.result),r&&r({progress:1,file:File})}),r&&"function"==typeof r&&c.on("progress",r),c.on("error",o),c.start(e)}else"string"==typeof e?n.isSHA256(e)?t(e):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"));return i}var n=e||{};return n.receipt=n.receipt||{},n.anchor=n.anchor||{},n.verify=n.verify||{},n.verify.WoleetDAB=function(e,t){return r(e,t).then(function(e){return n.anchor.getAnchorIDs(e)}).then(function(e){var r=[];return e.content.reduce(function(e,t){return e.then(function(){return n.receipt.get(t).then(function(e){return r.push(e)}).catch(function(e){if(202!=e.code)throw e})})},Promise.resolve()).then(function(){if(!r.length&&e.content.length)throw new Error("file_matched_but_anchor_not_yet_processed");return r})}).then(function(e){var r=e.map(function(e){try{return n.receipt.validate(e)}catch(e){return!1}}),t=r.every(function(e){return 1==e}),o=[];if(t)return e.reduce(function(e,r){return e.then(function(){return n.transaction.get(r.header.tx_id).then(function(e){o.push({receipt:r,confirmations:e.confirmations,confirmedOn:e.confirmedOn})})})},Promise.resolve()).then(function(){return o});throw new Error("invalid_receipt")})},n.verify.DAB=function(e,t,o){return r(e,o).then(function(e){if(n.receipt.validate(t),t.target.target_hash!=e)throw new Error("target_hash_mismatch");return n.transaction.get(t.header.tx_id).catch(function(e){if("tx_not_found"==e.message)throw e;return n.transaction.setDefaultProvider("blockcypher.com"),n.transaction.get(t.header.tx_id)}).catch(function(e){throw"tx_not_found"==e.message?e:new Error("error_while_getting_transaction")})}).then(function(e){if(e.opReturn==t.header.merkle_root)return{receipt:t,confirmations:e.confirmations,confirmedOn:e.confirmedOn};throw new Error("opReturn_mismatches_merkleRoot")})},n});
//# sourceMappingURL=woleet-verify.min.js.map
