"use strict";!function(a,b){"object"==typeof exports?module.exports=exports=b():"function"==typeof define&&define.amd?define([],b):a.CryptoJS=b()}(this,function(){var a=a||function(a,b){var c=Object.create||function(){function a(){}return function(b){var c;return a.prototype=b,c=new a,a.prototype=null,c}}(),d={},e=d.lib={},f=e.Base=function(){return{extend:function(a){var b=c(this);return a&&b.mixIn(a),b.hasOwnProperty("init")&&this.init!==b.init||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=e.WordArray=f.extend({init:function(a,c){a=this.words=a||[],c!=b?this.sigBytes=c:this.sigBytes=4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;f<e;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else for(var f=0;f<e;f+=4)b[d+f>>>2]=c[f>>>2];return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c,d=[],e=function(b){var b=b,c=987654321,d=4294967295;return function(){c=36969*(65535&c)+(c>>16)&d,b=18e3*(65535&b)+(b>>16)&d;var e=(c<<16)+b&d;return e/=4294967296,e+=.5,e*(a.random()>.5?1:-1)}},f=0;f<b;f+=4){var h=e(4294967296*(c||a.random()));c=987654071*h(),d.push(4294967296*h()|0)}return new g.init(d,b)}}),h=d.enc={},i=h.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw new Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=e.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=4*f,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*f,k=a.min(4*j,e);if(j){for(var l=0;l<j;l+=f)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new g.init(m,k)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),m=(e.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}}),d.algo={});return d}(Math);return a}),function(a,b){"object"==typeof exports?module.exports=exports=b(require("./core")):"function"==typeof define&&define.amd?define(["./core"],b):b(a.CryptoJS)}(this,function(a){return function(b){var c=a,d=c.lib,e=d.WordArray,f=d.Hasher,g=c.algo,h=[],i=[];!function(){function a(a){for(var c=b.sqrt(a),d=2;d<=c;d++)if(!(a%d))return!1;return!0}function c(a){return 4294967296*(a-(0|a))|0}for(var d=2,e=0;e<64;)a(d)&&(e<8&&(h[e]=c(b.pow(d,.5))),i[e]=c(b.pow(d,1/3)),e++),d++}();var j=[],k=g.SHA256=f.extend({_doReset:function(){this._hash=new e.init(h.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],k=c[5],l=c[6],m=c[7],n=0;n<64;n++){if(n<16)j[n]=0|a[b+n];else{var o=j[n-15],p=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,q=j[n-2],r=(q<<15|q>>>17)^(q<<13|q>>>19)^q>>>10;j[n]=p+j[n-7]+r+j[n-16]}var s=h&k^~h&l,t=d&e^d&f^e&f,u=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),v=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),w=m+v+s+i[n]+j[n],x=u+t;m=l,l=k,k=h,h=g+w|0,g=f,f=e,e=d,d=w+x|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+h|0,c[5]=c[5]+k|0,c[6]=c[6]+l|0,c[7]=c[7]+m|0},_doFinalize:function(){var a=this._data,c=a.words,d=8*this._nDataBytes,e=8*a.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=b.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,a.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=f.clone.call(this);return a._hash=this._hash.clone(),a}});c.SHA256=f._createHelper(k),c.HmacSHA256=f._createHmacHelper(k)}(Math),a.SHA256}),function(a,b){"object"==typeof exports?module.exports=exports=b(require("./core")):"function"==typeof define&&define.amd?define(["./core"],b):b(a.CryptoJS)}(this,function(a){return function(){if("function"==typeof ArrayBuffer){var b=a,c=b.lib,d=c.WordArray,e=d.init,f=d.init=function(a){if(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),(a instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)&&(a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),a instanceof Uint8Array){for(var b=a.byteLength,c=[],d=0;d<b;d++)c[d>>>2]|=a[d]<<24-d%4*8;e.call(this,c,b)}else e.apply(this,arguments)};f.prototype=d}}(),a.lib.WordArray}),function(a,b){a.woleet=b(a.woleet)}(void 0,function(a){function b(a){this.name="getJSON",this.message=a.statusText&&a.statusText.length?a.statusText:"Error wile getting data",this.code=a.status,this.body=a.response,this.stack=(new Error).stack}function c(a){var c=new XMLHttpRequest;return new Promise(function(d,e){c.onload=function(){switch(c.status){case 200:case 201:d("string"==typeof c.response?JSON.parse(c.response):c.response);break;case 404:d(null);break;default:e(new b(c))}},c.onerror=function(){e(new b(c))},c.open("GET",a,!0),c.responseType="json",c.json="json",c.send()})}function d(a,b,c,d,e){return"Invalid Date"==c.toString()&&(c=null),{tx_id:a,confirmations:b,confirmedAt:c,blockHash:d,opReturn:e}}b.prototype=Object.create(Error.prototype),b.prototype.constructor=b;var e="https://api.woleet.io/v1",f=a||{};return f.receipt=f.receipt||{},f.anchor=f.anchor||{},f.transaction=function(){var a="blockcypher.com";return{setDefaultProvider:function(b){switch(b){case"blockcypher.com":a=b;break;case"woleet.io":a=b;break;case"chain.so":default:a="chain.so"}},get:function(b){switch(a){case"woleet.io":return c(e+"/bitcoin/transaction/"+b).then(function(a){if(a&&200==a.status)return d(a.data.txid,a.data.confirmations,new Date(1e3*a.data.time),a.data.blockhash||0,function(a){var b=null;return a.forEach(function(a){if(a.hasOwnProperty("scriptPubKey")&&a.scriptPubKey.hasOwnProperty("asm")&&a.scriptPubKey.asm.indexOf("OP_RETURN")!=-1&&(b=a.scriptPubKey.asm.split(" ")[1]),b)return!0}),b}(a.data.vout||[]));throw new Error("tx_not_found")});case"chain.so":return c("https://chain.so/api/v2/get_tx/BTC/"+b).then(function(a){if(a&&"fail"!=a.status)return d(a.data.txid,a.data.confirmations,new Date(1e3*a.data.time),a.data.blockhash,function(a){var b=null;return a.forEach(function(a){if(a.hasOwnProperty("script")&&(a.script.indexOf("OP_RETURN")!=-1&&(b=a.script.split(" ")[1]),b))return!0}),b}(a.data.outputs||[]));throw new Error("tx_not_found")});case"blockcypher.com":return c("https://api.blockcypher.com/v1/btc/main/txs/"+b).then(function(a){if(!a||a.error)throw new Error("tx_not_found");return d(a.hash,a.confirmations,new Date(a.confirmed),a.block_hash,function(a){var b=null;return a.forEach(function(a){if(a.hasOwnProperty("data_hex")&&(b=a.data_hex),b)return!0}),b}(a.outputs||[]))})}}}}(),f.anchor.getAnchorIDs=function(a,b){return b=b||20,c(e+"/anchorids?size="+b+"&hash="+a)},f.receipt.get=function(a){return c(e+"/receipt/"+a).then(function(a){if(a)return a;throw new Error("not_found")})},f.isSHA256=function(a){var b=/^[A-Fa-f0-9]{64}$/;return b.test(a)},f}),function(a,b){a.woleet=b(a.woleet)}(void 0,function(a){function b(){function a(a){var b=window.URL||window.webkitURL,c=window.Blob,d=window.Worker;if(!(b&&c&&d&&a))return null;var e=new c([a]);return new d(b.createObjectURL(e))}return new Promise(function(b){var c="onmessage = function(e) { postMessage(!!FileReaderSync); };";try{var d=a(c);d?(d.onmessage=function(a){b(a.data)},d.postMessage({})):b(!1)}catch(a){b(!1)}})}var c="../dist/worker.min.js",d=b(),e=a||{};return e.file=e.file||{},e.file.Hasher=function(){var a,b,e,f,g=!0;this.on=function(c,d){switch(c){case"start":a=d;break;case"progress":b=d;break;case"error":f=d;break;case"result":e=d;break;default:throw new Error('Invalid event name "'+c+'"')}};var h=function(d,h){function i(){j>=h?(k.terminate(),g=!0):(k.postMessage(d.item(j)),j++)}var j=0,k=new Worker(c);k.onmessage=function(c){if(void 0!=c.data.progress)b&&b(c.data);else if(c.data.result)e&&e(c.data),i();else if(c.data.start)a&&a(c.data);else if(c.data.error){var d=c.data.error;if(!f)throw d;f(d)}else console.trace("Unexpected worker message :",c)},h!=-1?i():k.postMessage(d)},i=function(c,d){function h(c){var d=new Error("file_too_big_to_be_hashed_without_worker");if(c.size>5e7){if(g=!0,f)return f({error:d,file:c});throw d}a&&a({start:!0,file:c});var h,j=new FileReader,k=CryptoJS.algo.SHA256.create(),l=0;j.onloadend=function(){h.finalize(),e&&e({result:h._hash.toString(CryptoJS.enc.Hex),file:c}),i()},j.onprogress=function(a){var d=a.target.result,e=d.slice(l,a.loaded),f=new Uint8Array(e),g=CryptoJS.lib.WordArray.create(f);h=k.update(g),l=a.loaded,b&&b({progress:a.loaded/a.total,file:c})},j.readAsArrayBuffer(c)}function i(){j>=d?g=!0:(h(c.item(j)),j++)}var j=0;d!=-1?i():h(c)};this.start=function(a){if(!g)throw new Error("not_ready");var b=-1;if(a instanceof FileList)b=a.length;else if(!(a instanceof File))throw new Error("invalid_parameter");g=!1,d.then(function(c){if(c)h(a,b);else{if("undefined"==typeof CryptoJS)throw new Error("no_viable_hash_method");i(a,b)}})},this.isReady=function(){return g}},e}),function(a,b){a.woleet=b(a.woleet)}(void 0,function(a){function b(a,b,c){var e=c||d,f=a,g=b,h=e(f+g);this.get_parent=function(){return h},this.contains=function(a){return f==a||g==a},this.get_json=function(){return{parent:h,left:f,right:g}}}function c(a,b){var c=this;this.hash_f=b||d,this.branches=[],this.target=a,this.add=function(a){c.branches.push(a)},this.is_valid=function(){var a=c.target;if(!c.branches.length)return!1;for(var b,d=0;d<c.branches.length;d++){if(b=c.branches[d],!b.contains(a))return!1;a=b.get_parent()}return a},this.get_json=function(){var a=[];return c.branches.forEach(function(b){a.push(b.get_json())}),a}}var d=function(){function a(a,b){return b>>>a|b<<32-a}function b(b){return a(2,b)^a(13,b)^a(22,b)}function c(b){return a(6,b)^a(11,b)^a(25,b)}function d(b){return a(7,b)^a(18,b)^b>>>3}function e(b){return a(17,b)^a(19,b)^b>>>10}function f(a,b,c){return a&b^~a&c}function g(a,b,c){return a&b^a&c^b&c}return function(a){var h=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];a+=String.fromCharCode(128);for(var j=a.length/4+2,k=Math.ceil(j/16),l=new Array(k),m=0;m<k;m++){l[m]=new Array(16);for(var n=0;n<16;n++)l[m][n]=a.charCodeAt(64*m+4*n)<<24|a.charCodeAt(64*m+4*n+1)<<16|a.charCodeAt(64*m+4*n+2)<<8|a.charCodeAt(64*m+4*n+3)}var o=8*(a.length-1)/Math.pow(2,32),p=8*(a.length-1)>>>0;l[k-1][14]=Math.floor(o),l[k-1][15]=p;for(var q=0;q<k;q++){for(var r=new Array(64),s=0;s<16;s++)r[s]=l[q][s];for(var t=16;t<64;t++)r[t]=e(r[t-2])+r[t-7]+d(r[t-15])+r[t-16]>>>0;for(var u=i[0],v=i[1],w=i[2],x=i[3],y=i[4],z=i[5],A=i[6],B=i[7],C=0;C<64;C++){var D=B+c(y)+f(y,z,A)+h[C]+r[C],E=b(u)+g(u,v,w);B=A,A=z,z=y,y=x+D>>>0,x=w,w=v,v=u,u=D+E>>>0}i[0]=i[0]+u>>>0,i[1]=i[1]+v>>>0,i[2]=i[2]+w>>>0,i[3]=i[3]+x>>>0,i[4]=i[4]+y>>>0,i[5]=i[5]+z>>>0,i[6]=i[6]+A>>>0,i[7]=i[7]+B>>>0}for(var F=0;F<i.length;F++)i[F]=("00000000"+i[F].toString(16)).slice(-8);return i.join("")}}(),e=a||{};return e.receipt=e.receipt||{},e.receipt.validate=function(a){if(!(a&&a.target&&a.target.target_hash&&a.target.target_proof&&a.target.target_proof instanceof Array&&a.header&&a.header.hash_type&&a.header.merkle_root&&a.header.tx_id))throw new Error("invalid_receipt_format");for(var d=0;d<a.target.target_proof.length;d++){var f=a.target.target_proof[d];if(!f.left||!f.right||!f.parent)throw new Error("invalid_target_proof");if(!e.isSHA256(f.left)||!e.isSHA256(f.right)||!e.isSHA256(f.parent))throw new Error("non_sha256_target_proof_element")}if(0==a.target.target_proof.length){if(a.target.target_hash==a.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")}var g=new c(a.target.target_hash);if(a.target.target_proof.forEach(function(a){var c=new b(a.left,a.right);if(!c.get_parent()==a.parent)throw new Error("invalid_parent_in_proof_element");g.add(c)}),g.is_valid()==a.header.merkle_root)return!0;throw new Error("merkle_root_mismatch")},e}),function(a,b){a.woleet=b(a.woleet)}(void 0,function(a){var b=a||{};b.receipt=b.receipt||{},b.anchor=b.anchor||{},b.verify=b.verify||{},b.verify.WoleetDAB=function(a){return c(a).then(function(a){return b.anchor.getAnchorIDs(a)}).then(function(a){var c=[];return a.content.reduce(function(a,d){return a.then(function(){return b.receipt.get(d).then(function(a){return c.push(a)},function(a){if(202!=a.code)throw a})})},Promise.resolve()).then(function(){if(!c.length&&a.content.length)throw new Error("file_matched_but_anchor_not_yet_processed");return c})}).then(function(a){var c=a.map(function(a){try{return b.receipt.validate(a)}catch(a){return!1}}),d=c.every(function(a){return 1==a}),e=[];if(d)return a.reduce(function(a,c){return a.then(function(){return b.transaction.get(c.header.tx_id).then(function(a){e.push({receipt:c,confirmations:a.confirmations,date:a.confirmedAt})})})},Promise.resolve()).then(function(){return e});throw new Error("invalid_receipt")})},b.verify.DAB=function(a,d){return c(a).then(function(a){if(b.receipt.validate(d),d.target.target_hash!=a)throw new Error("target_hash_mismatch");return b.transaction.get(d.header.tx_id).then(function(a){return a},function(a){throw"tx_not_found"==a.message?a:new Error("error_while_getting_transaction")})}).then(function(a){if(a.opReturn==d.header.merkle_root)return{receipt:d,confirmations:a.confirmations,date:a.confirmedAt};throw new Error("opReturn_mismatches_merkleRoot")})};var c=function(a){var c,d,e=new Promise(function(a,b){c=a,d=b});if(a instanceof File){if(!b.file||!b.file.Hasher)throw new Error("missing_woleet_hash_dependency");var f=new b.file.Hasher;f.on("result",function(a,b){c(a.result)}),f.on("error",function(a){d(a)}),f.start(a)}else"string"==typeof a?b.isSHA256(a)?c(a):d(new Error("parameter_string_not_a_sha256_hash")):d(new Error("invalid_parameter"));return e};return b});