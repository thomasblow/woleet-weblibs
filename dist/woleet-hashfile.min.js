"use strict";!function(e,r){e.woleet=r(e.woleet)}(window,function(e){function r(){var e=document.getElementsByTagName("script"),r=Array.prototype.slice.call(e,0),t=/.*woleet-(hashfile|weblibs)[.min]*\.js$/,n=r.find(function(e){return e.src&&e.src.match(t)});return n&&n.src?n.src.substr(0,n.src.lastIndexOf("/")+1):null}function t(){function e(e){var r=window.URL||window.webkitURL,t=window.Blob,n=window.Worker;if(!(r&&t&&n&&e))return null;var o=new t([e]);return new n(r.createObjectURL(o))}return new Promise(function(r){var t="onmessage = function(e) { postMessage(!!FileReaderSync); };";try{var n=e(t);n?(n.onmessage=function(e){r(e.data)},n.postMessage({})):r(!1)}catch(e){r(!1)}})}var n=e||{};n.file=n.file||{};var o="https:"==location.protocol,i=window.crypto&&window.crypto.subtle&&window.crypto.subtle.digest&&o,a=t(),s=r(),f="woleet-hashfile-worker.min.js",l=n.workerScriptPath||(s?s+f:null);if(!l)throw new Error("Cannot find "+f);return n.file.Hasher=function(){var e=!0,r=void 0,t=void 0,n=void 0,o=void 0;this.on=function(e,i){switch(e){case"start":r=i;break;case"progress":t=i;break;case"error":o=i;break;case"result":n=i;break;default:throw new Error('Invalid event name "'+e+'"')}};var s=function(){var e=new Worker(l);this.hash=function(i){return new Promise(function(a,s){e.onmessage=function(i){if(void 0!=i.data.progress)t&&t(i.data);else if(i.data.result)n&&n(i.data),a(e);else if(i.data.start)r&&r(i.data);else if(i.data.error){var f=i.data.error;o?o(f):s(f)}else console.trace("Unexpected worker message: ",i)},e.postMessage(i)})}},f=function(i){return new Promise(function(a,s){var f=new Error("file_too_big_to_be_hashed_without_worker");if(i.size>5e7){if(e=!0,o)return o({error:f,file:i});s(f)}var l=new FileReader,c=CryptoJS.algo.SHA256.create(),u=void 0,d=0;l.onloadstart=function(){r&&r({start:!0,file:i})},l.onloadend=function(){u.finalize(),n&&n({result:u._hash.toString(CryptoJS.enc.Hex),file:i}),a()},l.onprogress=function(e){var r=e.target.result,n=r.slice(d,e.loaded),o=new Uint8Array(n),a=CryptoJS.lib.WordArray.create(o);u=c.update(a),d=e.loaded,t&&t({progress:e.loaded/e.total,file:i})},l.readAsArrayBuffer(i)})},c=function(e){return new Promise(function(i,a){var s="SHA-256",f=new FileReader;f.onloadstart=function(){r&&r({start:!0,file:e})},f.onprogress=function(r){t&&t({progress:r.loaded/r.total,file:e})},f.onload=function(r){var t=r.target.result;window.crypto.subtle.digest(s,t).then(function(r){var t=new Uint8Array(r),o=t.reduce(function(e,r){return e+("00"+r.toString(16)).slice(-2)},"");n&&n({result:o,file:e}),i()}).catch(function(r){return o?o({error:r,file:e}):a(r)})},f.readAsArrayBuffer(e)})};this.start=function(r){if(!e)throw new Error("not_ready");if(e=!1,!(r instanceof FileList||r instanceof File))throw new Error("invalid_parameter");a.then(function(t){function n(t,i,a){t>=i?(e=!0,a&&a.terminate()):o(r[t]).then(function(e){n(++t,i,e)})}var o=null;if(i)o=c;else if(t){var a=new s;o=a.hash}else{if("undefined"==typeof CryptoJS)throw new Error("no_viable_hash_method");o=f}r instanceof FileList?n(0,r.length):r instanceof File&&o(r).then(function(e){n(1,0,e)})})},this.isReady=function(){return e}},n.hashFileOrCheckHash=function(e,r){return new Promise(function(t,o){if(e instanceof File){if(!n.file||!n.file.Hasher)throw new Error("missing_woleet_hash_dependency");var i=new n.file.Hasher;i.on("result",function(e,n){t(e.result),r&&r({progress:1,file:n})}),r&&"function"==typeof r&&i.on("progress",r),i.on("error",o),i.start(e)}else"string"==typeof e?n.isSHA256(e)?t(e):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"))})},n});
//# sourceMappingURL=woleet-hashfile.min.js.map
