"use strict";!function(e,r){e.woleet=r(e.woleet)}(window,function(e){function r(){var e=document.getElementsByTagName("script"),r=Array.prototype.slice.call(e,0),n=/.*woleet-(hashfile|weblibs)[.min]*\.js$/,t=r.find(function(e){return e.src&&e.src.match(n)});return t&&t.src?t.src.substr(0,t.src.lastIndexOf("/")+1):null}function n(){function e(e){var r=window.URL||window.webkitURL,n=window.Blob,t=window.Worker;if(!(r&&n&&t&&e))return null;var o=new n([e]);return new t(r.createObjectURL(o))}return new Promise(function(r){var n="onmessage = function(e) { postMessage(!!FileReaderSync); close() };";try{!function(){var t=e(n);t?(t.onmessage=function(e){t.terminate(),t=null,r(e.data)},t.postMessage({})):r(!1)}()}catch(e){r(!1)}})}var t=e||{};t.file=t.file||{};var o="https:"==location.protocol,i=window.crypto&&window.crypto.subtle&&window.crypto.subtle.digest&&o,a=n(),s=r(),l="woleet-hashfile-worker.min.js",c=t.workerScriptPath||(s?s+l:null);if(!c)throw new Error("Cannot find "+l);return t.file.Hasher=function(){var e=!0,r=void 0,n=void 0,t=void 0,o=void 0,s=null,l=function(e){return s=e};this.on=function(e,i){switch(e){case"start":r=i;break;case"progress":n=i;break;case"error":o=i;break;case"result":t=i;break;default:throw new Error('Invalid event name "'+e+'"')}};var f=function(){var e=new Worker(c);this.hash=function(i){return new Promise(function(a,s){l(function(){e.terminate(),e=null,s("cancelled")}),e.onmessage=function(i){if(void 0!=i.data.progress)n&&n(i.data);else if(i.data.result)t&&t(i.data),a(e);else if(i.data.start)r&&r(i.data);else if(i.data.error){var l=i.data.error;o?o(l):s(l)}else console.trace("Unexpected worker message: ",i)},e.postMessage(i)})}},u=function(i){return new Promise(function(a,s){var c=new Error("file_too_big_to_be_hashed_without_worker");if(i.size>5e7){if(e=!0,o)return o({error:c,file:i});s(c)}var f=!1,u=new FileReader;l(function(){f=!0,u.abort()});var d=CryptoJS.algo.SHA256.create(),w=void 0,h=0;u.onloadstart=function(){f||r&&r({start:!0,file:i})},u.onloadend=function(){f||(w.finalize(),t&&t({result:w._hash.toString(CryptoJS.enc.Hex),file:i}),a())},u.onprogress=function(e){if(!f){var r=e.target.result,t=r.slice(h,e.loaded),o=new Uint8Array(t),a=CryptoJS.lib.WordArray.create(o);w=d.update(a),h=e.loaded,n&&n({progress:e.loaded/e.total,file:i})}},u.onabort=function(){s("cancelled")},u.readAsArrayBuffer(i)})},d=function(e){return new Promise(function(i,a){var s="SHA-256",c=!1,f=new FileReader;l(function(){c=!0,f.abort()}),f.onloadstart=function(){c||r&&r({start:!0,file:e})},f.onprogress=function(r){c||n&&n({progress:r.loaded/r.total,file:e})},f.onload=function(r){if(!c){var n=r.target.result;window.crypto.subtle.digest(s,n).then(function(r){var n=new Uint8Array(r),o=n.reduce(function(e,r){return e+("00"+r.toString(16)).slice(-2)},"");t&&t({result:o,file:e}),i()}).catch(function(r){return o?o({error:r,file:e}):a(r)})}},f.onabort=function(){a("cancelled")},f.readAsArrayBuffer(e)})};this.start=function(r){var n=5e8,t=null;if(!e)throw new Error("not_ready");if(e=!1,!(r instanceof FileList||r instanceof File))throw new Error("invalid_parameter");a.then(function(o){function a(r,s,l,c){if(!(r>=s)){var w=null;if(i&&l[r].size<n)w=d;else if(o)t||(t=new f),w=t.hash;else{if("undefined"==typeof CryptoJS)throw e=!0,new Error("no_viable_hash_method");w=u}return w(l[r]).then(function(e){return a(r+1,s,l,e||c)}).catch(function(e){if("cancelled"!==e)throw e})}e=!0,c&&(c.terminate(),c=null)}return r instanceof FileList?a(0,r.length,r):r instanceof File?a(0,1,[r]):void 0})},this.cancel=function(){s&&(s(),s=null,e=!0)},this.isReady=function(){return e}},t.hashFileOrCheckHash=function(e,r){return new Promise(function(n,o){if(e instanceof File){if(!t.file||!t.file.Hasher)throw new Error("missing_woleet_hash_dependency");var i=new t.file.Hasher;i.on("result",function(e,t){n(e.result),r&&r({progress:1,file:t})}),r&&"function"==typeof r&&i.on("progress",r),i.on("error",o),i.start(e)}else"string"==typeof e?t.isSHA256(e)?n(e):o(new Error("parameter_string_not_a_sha256_hash")):o(new Error("invalid_parameter"))})},t});
//# sourceMappingURL=woleet-hashfile.min.js.map
