"use strict";!function(e,r){e.woleet=r(e.woleet)}(window,function(e){function r(){var e=document.getElementsByTagName("script"),r=Array.prototype.slice.call(e,0),n=/.*woleet-(hashfile|weblibs)[.min]*\.js$/,t=r.find(function(e){return e.src&&e.src.match(n)});return t&&t.src?t.src.substr(0,t.src.lastIndexOf("/")+1):null}function n(){function e(e){var r=window.URL||window.webkitURL,n=window.Blob,t=window.Worker;if(!(r&&n&&t&&e))return null;var o=new n([e]);return new t(r.createObjectURL(o))}return new Promise(function(r){var n="onmessage = function(e) { postMessage(!!FileReaderSync); };";try{var t=e(n);t?(t.onmessage=function(e){r(e.data)},t.postMessage({})):r(!1)}catch(e){r(!1)}})}var t=n(),o=window.crypto&&window.crypto.subtle&&window.crypto.subtle.digest,i=e||{};i.file=i.file||{};var a=r();console.log(a);var s="woleet-hashfile-worker.min.js",l=i.workerScriptPath||(a?a+s:null);if(!l)throw new Error("Cannot find "+s);return i.file.Hasher=function(){var e=!0,r=void 0,n=void 0,i=void 0,a=void 0;this.on=function(e,t){switch(e){case"start":r=t;break;case"progress":n=t;break;case"error":a=t;break;case"result":i=t;break;default:throw new Error('Invalid event name "'+e+'"')}};var s=function(e){return new Promise(function(t,o){var s=new Worker(l);s.onmessage=function(e){if(void 0!=e.data.progress)n&&n(e.data);else if(e.data.result)i&&i(e.data),t();else if(e.data.start)r&&r(e.data);else if(e.data.error){var s=e.data.error;a?a(s):o(s)}else console.trace("Unexpected worker message: ",e)},s.postMessage(e)})},f=function(t){return new Promise(function(o,s){var l=new Error("file_too_big_to_be_hashed_without_worker");if(t.size>5e7){if(e=!0,a)return a({error:l,file:t});s(error)}var f=new FileReader,c=CryptoJS.algo.SHA256.create(),u=void 0,d=0;f.onloadstart=function(){r&&r({start:!0,file:t})},f.onloadend=function(){u.finalize(),i&&i({result:u._hash.toString(CryptoJS.enc.Hex),file:t}),o()},f.onprogress=function(e){var r=e.target.result,o=r.slice(d,e.loaded),i=new Uint8Array(o),a=CryptoJS.lib.WordArray.create(i);u=c.update(a),d=e.loaded,n&&n({progress:e.loaded/e.total,file:t})},f.readAsArrayBuffer(t)})},c=function(e){return new Promise(function(t,o){var s="SHA-256",l=new FileReader;l.onloadstart=function(){r&&r({start:!0,file:e})},l.onprogress=function(r){n&&n({progress:r.loaded/r.total,file:e})},l.onload=function(r){var n=r.target.result;window.crypto.subtle.digest(s,n).then(function(r){var n=new Uint8Array(r),o=n.reduce(function(e,r){return e+("00"+r.toString(16)).slice(-2)},"");i&&i({result:o,file:e}),t()}).catch(function(r){return a?a({error:r,file:e}):o(r)})},l.readAsArrayBuffer(e)})};this.start=function(r){if(!e)throw new Error("not_ready");if(e=!1,!(r instanceof FileList||r instanceof File))throw new Error("invalid_parameter");t.then(function(n){function t(n,o){n>=o?e=!0:i(r[n]).then(function(){t(++n,o)})}var i=null;if(o)i=c;else if(n)i=s;else{if("undefined"==typeof CryptoJS)throw new Error("no_viable_hash_method");i=f}r instanceof FileList?t(0,r.length):r instanceof File&&i(r).then(function(){e=!0})})},this.isReady=function(){return e}},i._hashStringOrFile=function(e,r){var n=void 0,t=void 0,o=new Promise(function(e,r){n=e,t=r});if(e instanceof File){if(!i.file||!i.file.Hasher)throw new Error("missing_woleet_hash_dependency");var a=new i.file.Hasher;a.on("result",function(e,t){n(e.result),r&&r({progress:1,file:File})}),r&&"function"==typeof r&&a.on("progress",r),a.on("error",function(e){t(e)}),a.start(e)}else"string"==typeof e?i.isSHA256(e)?n(e):t(new Error("parameter_string_not_a_sha256_hash")):t(new Error("invalid_parameter"));return o},i});
//# sourceMappingURL=woleet-hashfile.min.js.map
