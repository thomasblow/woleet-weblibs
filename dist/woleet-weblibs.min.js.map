{"version":3,"sources":["woleet-api.js","woleet-chainpoint.js","woleet-verify.js","woleet-hashfile.js"],"names":["root","factory","woleet","window","RequestError","req","this","name","message","statusText","length","code","status","body","response","stack","Error","getJSON","url","XMLHttpRequest","Promise","resolve","reject","onload","JSON","parse","onerror","open","responseType","json","send","makeTransaction","txId","confirmations","confirmedOn","blockHash","opReturn","toString","prototype","Object","create","constructor","woleetAPI","api","receipt","anchor","transaction","default_api","setDefaultProvider","get","then","res","txid","Date","time","blockhash","outputs","opr_return_found","forEach","output","hasOwnProperty","scriptPubKey","asm","indexOf","split","vout","data","script","error","hash","confirmed","block_hash","data_hex","getAnchorIDs","size","anchorId","isSHA256","sha256RegExp","test","MerkleBranch","left","right","hash_f","_hash_f","sha256","_left","_right","_parent","get_parent","contains","target","get_json","parent","MerkleProof","self","branches","add","branch","push","is_valid","new_target","i","json_data","R","n","x","F0","F1","S0","S1","Ch","y","z","Maj","msg","K","H","String","fromCharCode","l","N","Math","ceil","M","Array","j","charCodeAt","lenHi","pow","lenLo","floor","W","t","a","b","c","d","e","f","g","h","T1","T2","slice","join","validate","target_hash","target_proof","header","hash_type","merkle_root","tx_id","proof","merkleBranch","verify","WoleetDAB","file","hashStringOrFile","anchorIDsPage","receiptArray","content","reduce","chain","receiptsCheckOk","map","err","receiptsOk","every","finalArray","tx","date","DAB","resolveHash","rejectHash","hashPromise","File","Hasher","hasher","on","result","start","findBasePath","scripts","document","getElementsByTagName","src","basePath","substr","lastIndexOf","checkFileReaderSyncSupport","makeWorker","URL","webkitURL","Blob","Worker","blob","createObjectURL","syncDetectionScript","worker","onmessage","postMessage","DEFAUlT_WORKER_SCRIPT","workerScriptPath","testFileReaderSupport","cb_start","cb_progress","cb_result","cb_error","ready","event","callback","hashWorker","files","len","next","terminate","item","undefined","progress","console","trace","hashLocal","reader","FileReader","CryptoJS","algo","SHA256","prev","onloadend","finalize","_hash","enc","Hex","onprogress","buf","loaded","chunkUint8","Uint8Array","wordArr","lib","WordArray","update","total","readAsArrayBuffer","FileList","supported","isReady"],"mappings":"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","file":"woleet-weblibs.min.js","sourcesContent":["/**\n * @typedef {Object}   AnchorIDsPage\n * @typedef {String[]} Page.content array of anchorID\n * @typedef {Number}   Page.totalPages number of pages with the current size\n * @typedef {Number}   Page.totalElements number of elements matching the request\n * @typedef {Boolean}  Page.last boolean that indicates if the current page is the last one\n * @typedef {Boolean}  Page.sort boolean that indicates if the current page is the last one\n * @typedef {Boolean}  Page.first boolean that indicates if the current page is the first one\n * @typedef {Number}   Page.numberOfElements number of elements matching the request on the current page\n * @typedef {Number}   Page.size current page size\n * @typedef {Number}   Page.number current number (starting at 0)\n */\n\n;(function (root, factory) {\n    root.woleet = factory(root.woleet)\n})(window, function (woleet) {\n\n    function RequestError(req) {\n        this.name = 'getJSON';\n        this.message = req.statusText && req.statusText.length ? req.statusText : 'Error while getting data';\n        this.code = req.status;\n        //noinspection JSUnusedGlobalSymbols\n        this.body = req.response;\n        this.stack = (new Error()).stack;\n    }\n\n    RequestError.prototype = Object.create(Error.prototype);\n    //noinspection JSUnusedGlobalSymbols\n    RequestError.prototype.constructor = RequestError;\n\n    function getJSON(url) {\n        var req = new XMLHttpRequest();\n\n        return new Promise(function (resolve, reject) {\n\n            req.onload = function () {\n\n                switch (req.status) {\n                    case 200:\n                    case 201:\n                        typeof req.response == \"string\" ? resolve(JSON.parse(req.response)) : resolve(req.response); // ie\n                        break;\n                    case 404:\n                        resolve(null);\n                        break;\n                    default:\n                        reject(new RequestError(req));\n                        break;\n                }\n            };\n\n            req.onerror = function () {\n                reject(new RequestError(req));\n            };\n\n            req.open(\"GET\", url, true);\n            req.responseType = \"json\";\n            req.json = \"json\";\n            req.send();\n        });\n    }\n\n    /**\n     * @param {String} txId\n     * @param {Number} confirmations\n     * @param {Date} confirmedOn\n     * @param {String} blockHash\n     * @param {String} opReturn\n     */\n    function makeTransaction(txId, confirmations, confirmedOn, blockHash, opReturn) {\n\n        if (confirmedOn.toString() == \"Invalid Date\")\n            confirmedOn = null;\n\n        return {\n            txId: txId,\n            confirmations: confirmations,\n            confirmedOn: confirmedOn,\n            blockHash: blockHash,\n            opReturn: opReturn\n        }\n    }\n\n    var woleetAPI = \"https://api.woleet.io/v1\";\n    var api = woleet || {};\n    api.receipt = api.receipt || {};\n    api.anchor = api.anchor || {};\n\n    api.transaction = (function () {\n        var default_api = 'woleet.io';\n\n        return {\n            setDefaultProvider: function (api) {\n                switch (api) {\n                    case 'blockcypher.com':\n                        default_api = api;\n                        break;\n                    case 'woleet.io':\n                        default_api = api;\n                        break;\n                    case 'chain.so':\n                    default:\n                        default_api = 'chain.so';\n                        break;\n                }\n            },\n\n            /**\n             * @param txId\n             * @returns {Promise.<Transaction>}\n             */\n            get: function (txId) {\n                switch (default_api) {\n                    case 'woleet.io':\n                        return getJSON(woleetAPI + '/bitcoin/transaction/' + txId)\n                            .then(function (res) {\n                                if (!res) {\n                                    throw new Error('tx_not_found');\n                                }\n                                else {\n                                    //noinspection JSUnresolvedVariable\n                                    return makeTransaction(res.txid, res.confirmations, new Date(res.time * 1000), res.blockhash || 0,\n                                        (function (outputs) {\n                                            var opr_return_found = null;\n                                            outputs.forEach(function (output) {\n                                                if (output.hasOwnProperty('scriptPubKey')) {\n                                                    //noinspection JSUnresolvedVariable\n                                                    if (output.scriptPubKey.hasOwnProperty('asm')) {\n                                                        //noinspection JSUnresolvedVariable\n                                                        if (output.scriptPubKey.asm.indexOf('OP_RETURN') != -1) {\n                                                            //noinspection JSUnresolvedVariable\n                                                            opr_return_found = (((output.scriptPubKey.asm).split(' '))[1]);\n                                                        }\n                                                    }\n                                                }\n                                                if (opr_return_found) return true;//breaks foreach\n                                            });\n                                            return opr_return_found;\n                                        }(res.vout || []))\n                                    );\n                                }\n                            });\n                    case 'chain.so':\n                        return getJSON('https://chain.so/api/v2/get_tx/BTC/' + txId)\n                            .then(function (res) {\n                                if (!res || res.status == 'fail') {\n                                    throw new Error('tx_not_found');\n                                }\n                                else {\n                                    //noinspection JSUnresolvedVariable\n                                    return makeTransaction(res.data.txid, res.data.confirmations, new Date(res.data.time * 1000), res.data.blockhash,\n                                        (function (outputs) {\n                                            var opr_return_found = null;\n                                            outputs.forEach(function (output) {\n                                                if (output.hasOwnProperty('script')) {\n                                                    //noinspection JSUnresolvedVariable\n                                                    if (output.script.indexOf('OP_RETURN') != -1) {\n                                                        //noinspection JSUnresolvedVariable\n                                                        opr_return_found = (((output.script).split(' '))[1]);\n                                                    }\n                                                    if (opr_return_found) return true;//breaks foreach\n                                                }\n                                            });\n                                            return opr_return_found;\n                                        }(res.data.outputs || []))\n                                    );\n                                }\n                            });\n                    case 'blockcypher.com':\n                        return getJSON('https://api.blockcypher.com/v1/btc/main/txs/' + txId)\n                            .then(function (res) {\n                                if (!res || res.error) {\n                                    throw new Error('tx_not_found');\n                                }\n                                else {\n                                    //noinspection JSUnresolvedVariable\n                                    return makeTransaction(res.hash, res.confirmations, new Date(res.confirmed), res.block_hash,\n                                        (function (outputs) {\n                                            var opr_return_found = null;\n                                            outputs.forEach(function (output) {\n                                                if (output.hasOwnProperty('data_hex')) {\n                                                    //noinspection JSUnresolvedVariable\n                                                    opr_return_found = output.data_hex;\n                                                }\n                                                if (opr_return_found) return true;//breaks foreach\n                                            });\n                                            return opr_return_found;\n                                        }(res.outputs || []))\n                                    );\n                                }\n                            });\n                }\n            }\n        }\n    })();\n\n    /**\n     * @param {String} hash\n     * @param {Number} [size]\n     * @returns {Promise<AnchorIDsPage>}\n     */\n    api.anchor.getAnchorIDs = function (hash, size) {\n        size = size || 20;\n        return getJSON(woleetAPI + \"/anchorids?size=\" + size + \"&hash=\" + hash)\n    };\n\n\n    /**\n     * @param {String} anchorId\n     * @returns {Promise<Receipt>}\n     */\n    api.receipt.get = function (anchorId) {\n        return getJSON(woleetAPI + \"/receipt/\" + anchorId).then(function (res) {\n            if (!res) {\n                throw new Error('not_found');\n            }\n            else {\n                return res;\n            }\n        })\n    };\n\n    /**\n     * @param {Hash} hash\n     * @returns {boolean}\n     */\n    api.isSHA256 = function (hash) {\n        var sha256RegExp = /^[A-Fa-f0-9]{64}$/;\n        return sha256RegExp.test(hash);\n    };\n\n    return api;\n});\n\n","/**\n * @typedef {Object}   Leaf\n * @typedef {Hash}     Leaf.left\n * @typedef {Hash}     Leaf.right\n * @typedef {Hash}     Leaf.parent\n */\n\n/**\n * @typedef {Object}   Receipt\n * @typedef {Object}   Receipt.header\n * @typedef {String}   Receipt.header.chainpoint_version\n * @typedef {String}   Receipt.header.hash_type\n * @typedef {String}   Receipt.header.merkle_root\n * @typedef {String}   Receipt.header.tx_id\n * @typedef {String}   Receipt.header.timestamp\n * @typedef {Object}   Receipt.target\n * @typedef {String}   Receipt.target.target_hash\n * @typedef {String}   Receipt.target.target_URI\n * @typedef {Leaf[]}   Receipt.target.target_proof\n * @typedef {Object[]} Receipt.extra\n */\n\n;(function (root, factory) {\n    root.woleet = factory(root.woleet)\n})(window, function (woleet) {\n\n    /**\n     * @typedef {String} Hash\n     * @typedef {function(String): Hash} HashFunction\n     */\n\n    /**\n     * @type HashFunction\n     * @param {String} content\n     * @returns {Hash}\n     */\n\n    var sha256 = (function () {\n\n        /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\n        /* SHA-256 (FIPS 180-4) implementation in JavaScript                  (c) Chris Veness 2002-2016  */\n        /*                                                                                   MIT Licence  */\n        /* www.movable-type.co.uk/scripts/sha256.html                                                     */\n        /*                                                                                                */\n        /*  - see http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html                              */\n        /*        http://csrc.nist.gov/groups/ST/toolkit/examples.html                                    */\n        /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\n\n        'use strict';\n\n        function R(n, x) {\n            //noinspection JSConstructorReturnsPrimitive\n            return (x >>> n) | (x << (32 - n));\n        }\n\n        function F0(x) {\n            //noinspection JSConstructorReturnsPrimitive\n            return R(2, x) ^ R(13, x) ^ R(22, x);\n        }\n\n        function F1(x) {\n            //noinspection JSConstructorReturnsPrimitive\n            return R(6, x) ^ R(11, x) ^ R(25, x);\n        }\n\n        function S0(x) {\n            //noinspection JSConstructorReturnsPrimitive\n            return R(7, x) ^ R(18, x) ^ (x >>> 3);\n        }\n\n        function S1(x) {\n            //noinspection JSConstructorReturnsPrimitive\n            return R(17, x) ^ R(19, x) ^ (x >>> 10);\n        }\n\n        function Ch(x, y, z) {\n            //noinspection JSConstructorReturnsPrimitive\n            return (x & y) ^ (~x & z);\n        }\n\n        function Maj(x, y, z) {\n            //noinspection JSConstructorReturnsPrimitive\n            return (x & y) ^ (x & z) ^ (y & z);\n        }\n\n        return function (msg) {\n            var K = [\n                0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n                0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n                0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n                0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n                0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n                0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n                0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n                0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2];\n\n            var H = [0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19];\n\n            msg += String.fromCharCode(0x80);\n            var l = msg.length / 4 + 2;\n            var N = Math.ceil(l / 16);\n            var M = new Array(N);\n\n            for (var i = 0; i < N; i++) {\n                M[i] = new Array(16);\n                for (var j = 0; j < 16; j++) {\n                    M[i][j] = (msg.charCodeAt(i * 64 + j * 4) << 24) | (msg.charCodeAt(i * 64 + j * 4 + 1) << 16) |\n                        (msg.charCodeAt(i * 64 + j * 4 + 2) << 8) | (msg.charCodeAt(i * 64 + j * 4 + 3));\n                }\n            }\n            var lenHi = ((msg.length - 1) * 8) / Math.pow(2, 32);\n            var lenLo = ((msg.length - 1) * 8) >>> 0;\n            M[N - 1][14] = Math.floor(lenHi);\n            M[N - 1][15] = lenLo;\n\n            for (let i = 0; i < N; i++) {\n                let W = new Array(64);\n\n                for (let t = 0; t < 16; t++) W[t] = M[i][t];\n                for (let t = 16; t < 64; t++) {\n                    W[t] = (S1(W[t - 2]) + W[t - 7] + S0(W[t - 15]) + W[t - 16]) >>> 0;\n                }\n\n                let a = H[0], b = H[1], c = H[2], d = H[3], e = H[4], f = H[5], g = H[6], h = H[7];\n\n                for (let t = 0; t < 64; t++) {\n                    var T1 = h + F1(e) + Ch(e, f, g) + K[t] + W[t];\n                    var T2 = F0(a) + Maj(a, b, c);\n                    h = g;\n                    g = f;\n                    f = e;\n                    e = (d + T1) >>> 0;\n                    d = c;\n                    c = b;\n                    b = a;\n                    a = (T1 + T2) >>> 0;\n                }\n\n                H[0] = (H[0] + a) >>> 0;\n                H[1] = (H[1] + b) >>> 0;\n                H[2] = (H[2] + c) >>> 0;\n                H[3] = (H[3] + d) >>> 0;\n                H[4] = (H[4] + e) >>> 0;\n                H[5] = (H[5] + f) >>> 0;\n                H[6] = (H[6] + g) >>> 0;\n                H[7] = (H[7] + h) >>> 0;\n            }\n\n            for (var h = 0; h < H.length; h++) H[h] = ('00000000' + H[h].toString(16)).slice(-8);\n\n            return H.join('');\n        };\n    }());\n\n    /**\n     * Build a Merkle branch.\n     * @param {Hash} left\n     * @param {Hash} right\n     * @param {HashFunction} [hash_f]\n     * @constructor\n     */\n    function MerkleBranch(left, right, hash_f) {\n        /**\n         * @type {function(String): Hash}\n         */\n        var _hash_f = hash_f || sha256;\n        /***\n         * @type {Hash}\n         */\n        var _left = left;\n        /**\n         * @type {Hash}\n         */\n        var _right = right;\n        /**\n         * @type {Hash}\n         */\n        var _parent = _hash_f(_left + _right);\n\n        /**\n         * Get the parent of the branch.\n         * @returns {Hash}\n         */\n        this.get_parent = function () {\n            return _parent;\n        };\n\n        /**\n         * Check if a branch contains a hash.\n         * @param {Hash} target\n         * @returns {boolean}\n         */\n        this.contains = function (target) {\n            return _left == target || _right == target;\n        };\n\n        /**\n         * @returns {{parent: Hash, left: Hash, right: Hash}}\n         */\n        this.get_json = function () {\n            return {\n                \"parent\": _parent,\n                \"left\": _left,\n                \"right\": _right\n            }\n        };\n    }\n\n    /**\n     * Builds a Merkle proof.\n     * @param {String} target\n     * @param {Function} [hash_f]\n     * @constructor\n     */\n    function MerkleProof(target, hash_f) {\n        var self = this;\n\n        //noinspection JSUnusedGlobalSymbols\n        this.hash_f = hash_f || sha256;\n        this.branches = [];\n        this.target = target;\n\n        /**\n         * Add a branch to the proof.\n         * @param {MerkleBranch} branch\n         */\n        this.add = function (branch) {\n            self.branches.push(branch);\n        };\n\n        /**\n         * Returns the root string if proof is valid, false if it's not\n         * @returns {String|Boolean}\n         */\n        this.is_valid = function () {\n            // Check if the target hash is in the proof.\n\n            // We assume that the leaf is contained in the\n            // first branch of the proof, so then we check\n            // if the parent is contained in each higher\n            // branch.\n\n            var new_target = self.target;\n\n            if (!self.branches.length) return false;\n\n            for (var i = 0, branch; i < self.branches.length; i++) {\n                branch = self.branches[i];\n                if (!(branch.contains(new_target))) {\n                    return false;\n                }\n                new_target = branch.get_parent();\n            }\n\n            return new_target;\n        };\n\n        // MerkleProof to machine readable JSON.\n        this.get_json = function () {\n            var json_data = [];\n            self.branches.forEach(function (branch) {\n                json_data.push(branch.get_json());\n            });\n            return (json_data);\n        };\n    }\n\n    var api = woleet || {};\n    api.receipt = api.receipt || {};\n\n    /**\n     * Validate a receipt.\n     * @param {Receipt} receipt\n     * @returns {Boolean} true if the receipt is valid\n     */\n    api.receipt.validate = function (receipt) {\n\n        if (!receipt || !receipt.target || !receipt.target.target_hash || !receipt.target.target_proof\n            || !(receipt.target.target_proof instanceof Array) || !receipt.header || !receipt.header.hash_type\n            || !receipt.header.merkle_root || !receipt.header.tx_id) {\n            throw new Error(\"invalid_receipt_format\");\n        }\n\n        for (var i = 0; i < receipt.target.target_proof.length; i++) {\n            var branch = receipt.target.target_proof[i];\n            if (!branch.left || !branch.right || !branch.parent) {\n                throw new Error(\"invalid_target_proof\");\n            }\n            if (!api.isSHA256(branch.left) || !api.isSHA256(branch.right) || !api.isSHA256(branch.parent)) {\n                throw new Error(\"non_sha256_target_proof_element\");\n            }\n        }\n\n        // If no Merkle proof\n        if (receipt.target.target_proof.length == 0) {\n            // Receipt is valid if target hash is Merkle root\n            if (receipt.target.target_hash == receipt.header.merkle_root) return true;\n            else throw new Error(\"merkle_root_mismatch\");\n        }\n\n        // If there is a Merkle proof\n        else {\n\n            // Build the Merkle proof while checking its integrity\n            var proof = new MerkleProof(receipt.target.target_hash);\n            receipt.target.target_proof.forEach(function (branch) {\n\n                // Build a new Merkle branch\n                var merkleBranch = new MerkleBranch(branch.left, branch.right);\n\n                // Check that provided parent is correctly computed\n                if (!merkleBranch.get_parent() == branch.parent) {\n                    throw new Error(\"invalid_parent_in_proof_element\");\n                }\n\n                // Add Merkle branch to the Merkle proof\n                proof.add(merkleBranch);\n            });\n\n            // Receipt is valid if Merkle proof root is  Merkle root\n            if (proof.is_valid() == receipt.header.merkle_root) return true;\n            else throw new Error(\"merkle_root_mismatch\");\n        }\n    };\n\n    return api;\n});\n\n",";(function (root, factory) {\n    root.woleet = factory(root.woleet)\n})(window, function (woleet) {\n\n    var api = woleet || {};\n    api.receipt = api.receipt || {};\n    api.anchor = api.anchor || {};\n    api.verify = api.verify || {};\n\n    /**\n     * @param {File|String} file\n     * @returns {Promise.<Object[]>}\n     */\n    api.verify.WoleetDAB = function (file) {\n\n        return hashStringOrFile(file)\n\n        // We get the hash, so now we get the corresponding anchor ids\n            .then(function (hash) {\n                return api.anchor.getAnchorIDs(hash);\n            })\n\n            // We got ids (an array), for each of them, we get the corresponding receipts\n            .then(function (anchorIDsPage) {\n                var receiptArray = [];\n                return anchorIDsPage.content.reduce(function (chain, anchorId) {\n                    return chain.then(function () {\n                        return api.receipt.get(anchorId).then(function (receipt) {\n                            return receiptArray.push(receipt)\n                        }, function (error) {\n                            // if we cannot get the corresponding receipt for\n                            // this anchorID because it's not yet processed (202)\n                            // we ignore this element, else we forward error\n                            if (error.code != 202) throw error;\n                        })\n                    })\n                }, Promise.resolve())\n\n                // We got a receipt array, so we forward it\n                    .then(function () {\n                        // if we had a match but can't get a receipt\n                        if (!receiptArray.length && anchorIDsPage.content.length) {\n                            throw new Error('file_matched_but_anchor_not_yet_processed')\n                        }\n\n                        return receiptArray;\n                    });\n\n            })\n\n            .then(function (receiptArray) {\n\n                // We check each receipt we got\n                var receiptsCheckOk = receiptArray.map(function (receipt) {\n                    try {\n                        return api.receipt.validate(receipt);\n                    } catch (err) {\n                        return false;\n                    }\n                });\n\n                // We check that all of them are correct\n                var receiptsOk = receiptsCheckOk.every(function (e) {\n                    return e == true\n                });\n\n                var finalArray = [];\n\n                // If so, we get the corresponding transaction\n                if (receiptsOk) {\n                    return receiptArray.reduce(function (chain, receipt) {\n                        return chain.then(function () {\n                            return api.transaction.get(receipt.header.tx_id).then(function (tx) {\n                                finalArray.push({\n                                    receipt: receipt,\n                                    confirmations: tx.confirmations,\n                                    date: tx.confirmedOn\n                                })\n                            })\n                        })\n                    }, Promise.resolve())\n\n                    // We got a array of object with the {receipt, transactionDate}, so we forward it\n                        .then(function () {\n                            return finalArray;\n                        })\n                }\n                else {\n                    throw new Error(\"invalid_receipt\");\n                }\n            })\n    };\n\n    /**\n     * @param {File|String} file\n     * @param {Receipt} receipt\n     * @returns {Promise<Object>}\n     */\n    api.verify.DAB = function (file, receipt) {\n\n        return hashStringOrFile(file)\n\n            .then(function (hash) {\n\n                api.receipt.validate(receipt);\n\n                if (receipt.target.target_hash != hash) throw new Error(\"target_hash_mismatch\");\n\n                return api.transaction.get(receipt.header.tx_id)\n                    .then(function (tx) {\n                        return tx;\n                    }, function (error) {\n                        if (error.message == 'tx_not_found') {\n                            throw error;\n                        }\n                        else {\n                            throw new Error(\"error_while_getting_transaction\")\n                        }\n                    })\n            })\n\n            .then(function (tx) {\n\n                if (tx.opReturn == receipt.header.merkle_root)\n                    return {\n                        receipt: receipt,\n                        confirmations: tx.confirmations,\n                        confirmedOn: tx.confirmedOn\n                    }; // opReturn matches root\n                else\n                    throw new Error('opReturn_mismatches_merkleRoot')\n\n            })\n    };\n\n    var hashStringOrFile = function (file) {\n        var resolveHash;\n        var rejectHash;\n        var hashPromise = new Promise(function (resolve, reject) {\n            resolveHash = resolve;\n            rejectHash = reject;\n        });\n\n        if (file instanceof File) {\n\n            if (!api.file || !api.file.Hasher) throw new Error(\"missing_woleet_hash_dependency\");\n\n            var hasher = new api.file.Hasher;\n            //noinspection JSUnusedLocalSymbols\n            hasher.on('result', function (message, file) {\n                resolveHash(message.result);\n            });\n\n            hasher.on('error', function (error) {\n                rejectHash(error);\n            });\n\n            hasher.start(file)\n        }\n        else if (typeof file == \"string\") {\n            if (api.isSHA256(file)) {\n                //noinspection JSUnusedAssignment\n                resolveHash(file);\n            }\n            else {\n                //noinspection JSUnusedAssignment\n                rejectHash(new Error(\"parameter_string_not_a_sha256_hash\"));\n            }\n        }\n        else {\n            //noinspection JSUnusedAssignment\n            rejectHash(new Error(\"invalid_parameter\"));\n        }\n\n        return hashPromise;\n    };\n\n    return api;\n});","/**\n * @typedef {Object}   ProgressMessage\n * @typedef {Number}   ProgressMessage.progress (float number)\n * @typedef {File}     ProgressMessage.file\n */\n\n/**\n * @typedef {Object}   StartMessage\n * @typedef {Boolean}  StartMessage.start always true\n * @typedef {File}     ProgressMessage.file\n */\n\n/**\n * @typedef {Object}   ErrorMessage\n * @typedef {Error}    ErrorMessage.error\n * @typedef {File}     EndMessage.file\n */\n\n/**\n * @typedef {Object}   EndMessage\n * @typedef {String}   EndMessage.end hash of the file\n * @typedef {File}     EndMessage.file\n */\n\n;(function (root, factory) {\n    root.woleet = factory(root.woleet)\n})(window, function (woleet) {\n\n    /**\n     * @returns the base path (including final '/') of the current script.\n     */\n    function findBasePath() {\n        var scripts = document.getElementsByTagName('script'),\n            script = scripts[scripts.length - 1].src, // last script is always the current script\n            basePath = script.substr(0, script.lastIndexOf(\"/\") + 1);\n        return basePath;\n    }\n\n    // Guess the path of the worker script: same as current script's or defined by woleet.workerScriptPath\n    var basePath = findBasePath();\n    var DEFAUlT_WORKER_SCRIPT = \"woleet-hashfile-worker.min.js\";\n    var workerScriptPath = (woleet.workerScriptPath || (basePath ? basePath + DEFAUlT_WORKER_SCRIPT : null));\n    if (!workerScriptPath)\n        throw new Error('Cannot find ' + DEFAUlT_WORKER_SCRIPT);\n\n    /**\n     * Check support for workers.\n     */\n    function checkFileReaderSyncSupport() {\n\n        function makeWorker(script) {\n            //noinspection JSUnresolvedVariable\n            var URL = window.URL || window.webkitURL;\n            var Blob = window.Blob;\n            var Worker = window.Worker;\n\n            if (!URL || !Blob || !Worker || !script) return null;\n\n            var blob = new Blob([script]);\n            //noinspection JSUnresolvedFunction\n            return new Worker(URL.createObjectURL(blob));\n        }\n\n        return new Promise(function (resolve) {\n            var syncDetectionScript = \"onmessage = function(e) { postMessage(!!FileReaderSync); };\";\n            try {\n                var worker = makeWorker(syncDetectionScript);\n                if (worker) {\n                    worker.onmessage = function (e) {\n                        resolve(e.data);\n                    };\n                    worker.postMessage({});\n                }\n                else resolve(false);\n            } catch (err) {\n                resolve(false);\n            }\n        });\n    }\n\n    var testFileReaderSupport = checkFileReaderSyncSupport();\n\n    var api = woleet || {};\n    api.file = api.file || {};\n\n    api.file.Hasher = function () {\n\n        var ready = true;\n        var cb_start, cb_progress, cb_result, cb_error;\n\n        /**\n         * @param {String} event\n         * @param {Function} callback\n         */\n        this.on = function (event, callback) {\n            switch (event) {\n                case 'start':\n                    cb_start = callback;\n                    break;\n                case 'progress':\n                    cb_progress = callback;\n                    break;\n                case 'error':\n                    cb_error = callback;\n                    break;\n                case 'result':\n                    cb_result = callback;\n                    break;\n                default:\n                    throw new Error('Invalid event name \"' + event + '\"');\n            }\n        };\n\n        /**\n         * @param {FileList|File} files\n         * @param {Number} len\n         */\n        var hashWorker = function (files, len) {\n            var i = 0;\n            var worker = new Worker(workerScriptPath);\n\n            worker.onmessage = function (message) {//handling worker message\n                if (message.data.progress != undefined) {\n                    if (cb_progress) cb_progress(message.data);\n                }\n                else if (message.data.result) {\n                    if (cb_result) cb_result(message.data);\n                    next();\n                }\n                else if (message.data.start) {\n                    if (cb_start) cb_start(message.data);\n                }\n                else if (message.data.error) {\n                    var error = message.data.error;\n                    if (cb_error) cb_error(error);\n                    else throw error;\n                }\n                else {\n                    console.trace(\"Unexpected worker message: \", message);\n                }\n            };\n\n            function next() {\n                if ((i >= len)) {\n                    worker.terminate();\n                    ready = true;\n                }\n                else {\n                    worker.postMessage(files.item(i));\n                    i++;\n                }\n            }\n\n            //entry point\n            if (len != -1) next();// if files is a list\n            else {\n                worker.postMessage(files);\n            }\n        };\n\n        /**\n         * @param {FileList|File} files\n         * @param {Number} len\n         */\n        var hashLocal = function (files, len) {\n            var i = 0;\n\n            /**\n             * @param {File} file\n             */\n            function hash(file) {\n                var err = new Error(\"file_too_big_to_be_hashed_without_worker\");\n                if (file.size > 5e7) {\n                    ready = true;\n                    if (cb_error) return cb_error({error: err, file: file});\n                    else throw err;\n                }\n                if (cb_start) cb_start({start: true, file: file});\n\n                var reader = new FileReader();\n\n                var sha256 = CryptoJS.algo.SHA256.create();\n                var hash, prev = 0;\n\n                reader.onloadend = function () {\n                    hash.finalize();\n                    if (cb_result) cb_result({\n                        result: hash._hash.toString(CryptoJS.enc.Hex),\n                        file: file\n                    });\n                    next();\n                };\n\n                reader.onprogress = function (e) {\n                    //noinspection JSUnresolvedVariable\n                    /** @type ArrayBuffer */\n                    var buf = e.target.result;\n                    //noinspection JSUnresolvedVariable\n                    var blob = buf.slice(prev, e.loaded);\n                    var chunkUint8 = new Uint8Array(blob);\n                    var wordArr = CryptoJS.lib.WordArray.create(chunkUint8);\n                    hash = sha256.update(wordArr);\n                    //noinspection JSUnresolvedVariable\n                    prev = e.loaded;\n                    if (cb_progress) {\n                        //noinspection JSUnresolvedVariable\n                        cb_progress({progress: (e.loaded / e.total), file: file});\n                    }\n                };\n\n                reader.readAsArrayBuffer(file);\n            }\n\n            function next() {\n                if ((i >= len)) {\n                    ready = true;\n                }\n                else {\n                    hash(files.item(i));\n                    i++;\n                }\n            }\n\n            //entry point\n            if (len != -1) next();// if files is a list\n            else {\n                hash(files);\n            }\n        };\n\n        this.start = function (files) {\n\n            if (!ready) throw new Error(\"not_ready\");\n\n            var len = -1;\n\n            if (files instanceof FileList) {\n                len = files.length;\n            }\n            else if (files instanceof File) {\n\n            }\n            else throw new Error(\"invalid_parameter\");\n\n            ready = false;\n\n            testFileReaderSupport.then(function (supported) {\n                if (supported) {\n                    hashWorker(files, len);\n                }\n                else if (typeof CryptoJS !== 'undefined') {\n                    hashLocal(files, len);\n                }\n                else {\n                    throw new Error(\"no_viable_hash_method\");\n                }\n            });\n\n        };\n\n        this.isReady = function () {\n            return ready;\n        };\n    };\n\n    return api;\n});"]}